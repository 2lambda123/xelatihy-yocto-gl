
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <meta name="author" content="Fabio Pellacini">
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.0.5">
    
    
      
        <title>Model serialization - Yocto/GL</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.77f3fd56.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.7fa14f5b.min.css">
        
          
          
          <meta name="theme-color" content="#2094f3">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue" data-md-color-accent="">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#yoctomodelio-serialization-for-obj-ply-and-pbrt-models" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Yocto/GL" class="md-header__button md-logo" aria-label="Yocto/GL">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Yocto/GL
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Model serialization
            
          </span>
        </div>
      </div>
    </div>
    <div class="md-header__options">
      
    </div>
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/xelatihy/yocto-gl/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    xelatihy/yocto-gl
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Yocto/GL" class="md-nav__button md-logo" aria-label="Yocto/GL">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Yocto/GL
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/xelatihy/yocto-gl/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    xelatihy/yocto-gl
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../gallery/" class="md-nav__link">
        Gallery
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_math/" class="md-nav__link">
        Math types
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_color/" class="md-nav__link">
        Color operations
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_geometry/" class="md-nav__link">
        Geometry operations
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_sampling/" class="md-nav__link">
        Sampling routines
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_noise/" class="md-nav__link">
        Noise functions
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_shading/" class="md-nav__link">
        Shading routines
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_image/" class="md-nav__link">
        Image utilities
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_shape/" class="md-nav__link">
        Shape utilities
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_mesh/" class="md-nav__link">
        Mesh processing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_scene/" class="md-nav__link">
        Scene representation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_bvh/" class="md-nav__link">
        Ray-scene intersection
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_trace/" class="md-nav__link">
        Path tracing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_cli/" class="md-nav__link">
        Command-line utilities
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_imageio/" class="md-nav__link">
        Image serialization
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_shapeio/" class="md-nav__link">
        Shape serialization
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_sceneio/" class="md-nav__link">
        Scene serialization
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_commonio/" class="md-nav__link">
        Json and serialization utilities
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Model serialization
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Model serialization
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#errors-handling-in-io-functions" class="md-nav__link">
    Errors handling in IO functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ply-models" class="md-nav__link">
    Ply models
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ply-reading" class="md-nav__link">
    Ply reading
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ply-writing" class="md-nav__link">
    Ply writing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#obj-models" class="md-nav__link">
    Obj models
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#obj-reading" class="md-nav__link">
    Obj reading
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#obj-writing" class="md-nav__link">
    Obj writing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stl-models" class="md-nav__link">
    Stl models
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stl-reading" class="md-nav__link">
    Stl reading
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stl-writing" class="md-nav__link">
    Stl writing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pbrt-models" class="md-nav__link">
    Pbrt models
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_parallel/" class="md-nav__link">
        Concurrency utilities
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#errors-handling-in-io-functions" class="md-nav__link">
    Errors handling in IO functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ply-models" class="md-nav__link">
    Ply models
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ply-reading" class="md-nav__link">
    Ply reading
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ply-writing" class="md-nav__link">
    Ply writing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#obj-models" class="md-nav__link">
    Obj models
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#obj-reading" class="md-nav__link">
    Obj reading
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#obj-writing" class="md-nav__link">
    Obj writing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stl-models" class="md-nav__link">
    Stl models
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stl-reading" class="md-nav__link">
    Stl reading
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stl-writing" class="md-nav__link">
    Stl writing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pbrt-models" class="md-nav__link">
    Pbrt models
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="yoctomodelio-serialization-for-obj-ply-and-pbrt-models">Yocto/ModelIO: Serialization for Obj, Ply and Pbrt models</h1>
<p>Yocto/ModelIO is a collection of utilities for loading and saving scenes
and meshes in Ply, Obj, Stl and Pbrt formats.
Yocto/ModelIO is implemented in <code>yocto_modelio.h</code> and <code>yocto_modelio.cpp</code>.</p>
<h2 id="errors-handling-in-io-functions">Errors handling in IO functions</h2>
<p>IO functions in Yocto/ModelIO have a dual interface to support their use with
and without exceptions. IO functions with exception are written as 
<code>load_&lt;type&gt;(filename, data, &lt;options&gt;)</code> and 
<code>save_&lt;type&gt;(filename, data, &lt;options&gt;)</code> where <code>&lt;type&gt;</code> is the data type 
read or written, and <code>&lt;options&gt;</code> is an optional list of IO options. 
A convenience shortcut is provided for all loading functions that returns the 
data directly, written as <code>data = load_&lt;type&gt;(filename, &lt;options&gt;)</code>.
Upon errors, an <code>io_error</code> is thrown from all IO functions.
This makes the error-handling code more uniform across the library. 
<code>io_error</code> has fields for <code>filename</code> and <code>message</code> that can retrieved directly, 
and a message for users that can be retrieved with the <code>.what()</code> method.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">ply</span> <span class="o">=</span> <span class="n">string</span><span class="p">{};</span>
<span class="k">try</span> <span class="p">{</span>
  <span class="n">load_ply</span><span class="p">(</span><span class="s">&quot;input_file.ply&quot;</span><span class="p">,</span>  <span class="n">ply</span><span class="p">);</span>   <span class="c1">// load ply</span>
  <span class="n">ply</span> <span class="o">=</span> <span class="n">load_ply</span><span class="p">(</span><span class="s">&quot;input_file.ply&quot;</span><span class="p">);</span>   <span class="c1">// alternative load</span>
  <span class="n">save_ply</span><span class="p">(</span><span class="s">&quot;output_file.ply&quot;</span><span class="p">,</span> <span class="n">ply</span><span class="p">);</span>   <span class="c1">// save ply</span>
<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="k">const</span> <span class="n">io_error</span><span class="o">&amp;</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">print_info</span><span class="p">(</span><span class="n">error</span><span class="p">.</span><span class="n">what</span><span class="p">());</span> <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>    <span class="c1">// handle error</span>
<span class="p">}</span>
</code></pre></div>
<p>IO functions without exceptions are written as
<code>load_&lt;type&gt;(filename, data, error, &lt;options&gt;)</code> and 
<code>save_&lt;type&gt;(filename, data, error, &lt;options&gt;)</code> where <code>error</code> is a string 
that contains a message if an error occurred. These functions return a boolean 
flag that indicates whether the operation succeeded.  </p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">ply</span> <span class="o">=</span> <span class="n">string</span><span class="p">{};</span>
<span class="k">auto</span> <span class="n">error</span> <span class="o">=</span> <span class="n">string</span><span class="p">{};</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">load_ply</span><span class="p">(</span><span class="s">&quot;input_file.ply&quot;</span><span class="p">,</span>  <span class="n">ply</span><span class="p">))</span>      <span class="c1">// load ply</span>
  <span class="n">print_info</span><span class="p">(</span><span class="n">error</span><span class="p">);</span> <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>              <span class="c1">// handle error</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">save_ply</span><span class="p">(</span><span class="s">&quot;output_file.ply&quot;</span><span class="p">,</span> <span class="n">ply</span><span class="p">))</span>      <span class="c1">// save ply</span>
  <span class="n">print_info</span><span class="p">(</span><span class="n">error</span><span class="p">);</span> <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>              <span class="c1">// handle error</span>
</code></pre></div>
<h2 id="ply-models">Ply models</h2>
<p>The Ply file format is a generic file format used to serialize meshes and point
clouds. To use this library is helpful to understand the basic of the Ply
file format for example from the
<a href="https://en.wikipedia.org/wiki/PLY_(file_format)">Ply Wikipedia page</a>.</p>
<p>Yocto/ModelIO represents Ply data with the <code>ply_model</code> struct.
The internal representation matches the structure of a Ply file and
can be accessed directly if desired. The Ply model is defined as an array
of Ply elements, which in turn are defined as arrays of Ply properties.
Ply properties can contain most C data types.
All elements and properties are owned by the main <code>ply_model</code>.
Yocto/ModelIO provides several functions to read and write Ply data
whose use is preferred over direct data access.</p>
<p>Use <code>load_ply(filename, ply)</code> or <code>ply = load_ply(filename)</code> to load Ply files 
and <code>save_ply(filename, ply)</code> to save them.<br />
Both loading and saving take a filename, a reference to a model, and throw 
an exception <code>io_error</code> exception if the file was not loaded successfully.
Use without exception is supported as described above.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">ply</span> <span class="o">=</span> <span class="n">ply_model</span><span class="p">{};</span>      <span class="c1">// ply model buffer</span>
<span class="n">load_ply</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">ply</span><span class="p">);</span>     <span class="c1">// load ply</span>
<span class="n">ply</span> <span class="o">=</span> <span class="n">load_ply</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>    <span class="c1">// alternative load</span>
<span class="n">save_ply</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">ply</span><span class="p">;</span>      <span class="c1">// save ply</span>
</code></pre></div>
<h2 id="ply-reading">Ply reading</h2>
<p>Yocto/ModelIO defines several functions to make it easy to extract data
from Ply files. Since Ply properties cane be stored with many different
C types, the convenience functions convert the various underlying
representations to the requested one.</p>
<p>Use <code>has_property(ply,element,property)</code> to check whether the model has
a property named <code>property</code> in an element named <code>element</code>. Use
<code>get_property(ply,element,property)</code> to get that property.</p>
<p>Use <code>get_value(ply, element, property, values)</code> to get the property values
and stored them in the array <code>values</code>. The function returns whether or not
the property was present. Since Ply properties are often stored together,
e.g. xyz coordinates, Yocto/ModelIO supports queries that take arrays of
properties and returns values packed in <code>vecXf</code>.
Use <code>get_values(ply, element, properties, values)</code> to read arrays of
properties.</p>
<p>For list properties, Yocto/ModelIO supports reading properties as
arrays of arrays of dynamic size with <code>get_lists(ply,element,property,lists)</code>.
A faster, but harder to use, method is to get lists sizes and values as
separate arrays, where list values are packed together to avoid small memory
allocations. Use <code>get_list_sizes(ply, element, property, sizes)</code> for sizes
and <code>get_list_values(ply, element, property, values)</code> for values.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">ply</span> <span class="o">=</span> <span class="n">ply_model</span><span class="p">{};</span>                 <span class="c1">// ply model buffer</span>
<span class="k">auto</span> <span class="n">error</span> <span class="o">=</span> <span class="n">string</span><span class="p">{};</span>                  <span class="c1">// error buffer</span>
<span class="n">load_ply</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">ply</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>         <span class="c1">// load ply</span>

<span class="k">auto</span> <span class="n">radius</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">{};</span>                   <span class="c1">// property buffer</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">get_value</span><span class="p">(</span><span class="n">ply</span><span class="p">,</span> <span class="s">&quot;vertex&quot;</span><span class="p">,</span> <span class="s">&quot;radius&quot;</span><span class="p">,</span> <span class="n">radius</span><span class="p">))</span>  <span class="c1">// read property</span>
  <span class="n">print_error</span><span class="p">(</span><span class="s">&quot;missing radius&quot;</span><span class="p">);</span>                 <span class="c1">// error if missing</span>
<span class="k">auto</span> <span class="n">positions</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec3f</span><span class="o">&gt;</span><span class="p">{};</span>                <span class="c1">// properties buffer</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">get_values</span><span class="p">(</span><span class="n">ply</span><span class="p">,</span> <span class="s">&quot;vertex&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="s">&quot;y&quot;</span><span class="p">,</span><span class="s">&quot;z&quot;</span><span class="p">},</span> <span class="n">positions</span><span class="p">))</span> <span class="c1">// read properties</span>
  <span class="n">print_error</span><span class="p">(</span><span class="s">&quot;missing positions&quot;</span><span class="p">);</span>              <span class="c1">// error if missing</span>

<span class="k">auto</span> <span class="n">faces</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span><span class="p">{};</span>              <span class="c1">// list property buffer</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">get_lists</span><span class="p">(</span><span class="n">ply</span><span class="p">,</span> <span class="s">&quot;face&quot;</span><span class="p">,</span> <span class="s">&quot;indices&quot;</span><span class="p">,</span> <span class="n">faces</span><span class="p">))</span>    <span class="c1">// read lists</span>
  <span class="n">print_error</span><span class="p">(</span><span class="s">&quot;missing faces&quot;</span><span class="p">);</span>                  <span class="c1">// error if missing</span>

<span class="k">auto</span> <span class="n">faces_sizes</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{};</span>                <span class="c1">// list property sizes</span>
<span class="k">auto</span> <span class="n">faces_values</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{};</span>               <span class="c1">// list property values</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">get_list_sizes</span><span class="p">(</span><span class="n">ply</span><span class="p">,</span> <span class="s">&quot;face&quot;</span><span class="p">,</span> <span class="s">&quot;indices&quot;</span><span class="p">,</span> <span class="n">faces_sizes</span><span class="p">))</span> <span class="c1">// read lists sizes</span>
  <span class="n">print_error</span><span class="p">(</span><span class="s">&quot;missing faces&quot;</span><span class="p">);</span>                  <span class="c1">// error if missing</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">get_list_values</span><span class="p">(</span><span class="n">ply</span><span class="p">,</span> <span class="s">&quot;face&quot;</span><span class="p">,</span> <span class="s">&quot;indices&quot;</span><span class="p">,</span> <span class="n">faces_values</span><span class="p">))</span> <span class="c1">// read lists values</span>
  <span class="n">print_error</span><span class="p">(</span><span class="s">&quot;missing faces&quot;</span><span class="p">);</span>                  <span class="c1">// error if missing</span>
</code></pre></div>
<p>Yocto/Shape defines convenience functions to read the most used properties
of meshes, using standard element and property names.
For vertex properties, use <code>get_positions(ply, positions)</code>,
<code>get_normals(ply, normals)</code>, <code>get_texcoords(ply, texcoords, flipv)</code>,
<code>get_colors(ply, colors)</code>, and <code>get_radius(ply, radius)</code> to read positions,
normals, texcoords, colors and radius if present. Texture coordinates can be
optionally flipped vertically. For shape elements, use
<code>get_points(ply, points)</code>, <code>get_lines(ply, lines)</code>,
<code>get_triangles(ply, triangles)</code>, and <code>get_quads(ply, quads)</code>, to read
points, lines, triangles and quads. Note that since Ply support arbitrary
polygons and polylines, these functions tesselate the Ply polygons into
the desired element type, for now using a simple fan-like algorithm that
works only for convex elements. Use <code>has_quads(ply)</code> to check whether
the Ply data has quads, or use <code>get_faces(ply, triangles, quads)</code> to
triangles or quads.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">ply</span> <span class="o">=</span> <span class="n">ply_model</span><span class="p">{};</span>                 <span class="c1">// ply model buffer</span>
<span class="k">auto</span> <span class="n">error</span> <span class="o">=</span> <span class="n">string</span><span class="p">{};</span>                  <span class="c1">// error buffer</span>
<span class="n">load_ply</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">ply</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>         <span class="c1">// load ply</span>

<span class="k">auto</span> <span class="n">positions</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec3f</span><span class="o">&gt;</span><span class="p">{};</span>       <span class="c1">// vertex properties buffers</span>
<span class="k">auto</span> <span class="n">normals</span>   <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec3f</span><span class="o">&gt;</span><span class="p">{};</span>
<span class="k">auto</span> <span class="n">texcoords</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec2f</span><span class="o">&gt;</span><span class="p">{};</span>
<span class="k">auto</span> <span class="n">colors</span>    <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec3f</span><span class="o">&gt;</span><span class="p">{};</span>
<span class="k">auto</span> <span class="n">radius</span>    <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">{};</span>
<span class="n">get_positions</span><span class="p">(</span><span class="n">ply</span><span class="p">,</span> <span class="n">positions</span><span class="p">);</span>          <span class="c1">// read vertex props.</span>
<span class="n">get_normals</span><span class="p">(</span><span class="n">ply</span><span class="p">,</span> <span class="n">normals</span><span class="p">);</span>
<span class="n">get_texcoords</span><span class="p">(</span><span class="n">ply</span><span class="p">,</span> <span class="n">texcoords</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>   <span class="c1">// last params, flips y is desired</span>
<span class="n">get_colors</span><span class="p">(</span><span class="n">ply</span><span class="p">,</span> <span class="n">colors</span><span class="p">);</span>
<span class="n">get_radius</span><span class="p">(</span><span class="n">ply</span><span class="p">,</span> <span class="n">radius</span><span class="p">);</span>

<span class="k">auto</span> <span class="n">points</span>    <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec4i</span><span class="o">&gt;</span><span class="p">{};</span>       <span class="c1">// shape elements buffers</span>
<span class="k">auto</span> <span class="n">lines</span>     <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec4i</span><span class="o">&gt;</span><span class="p">{};</span>
<span class="k">auto</span> <span class="n">triangles</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec4i</span><span class="o">&gt;</span><span class="p">{};</span>
<span class="k">auto</span> <span class="n">quads</span>     <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec4i</span><span class="o">&gt;</span><span class="p">{};</span>
<span class="n">get_points</span><span class="p">(</span><span class="n">ply</span><span class="p">,</span> <span class="n">points</span><span class="p">);</span>
<span class="n">get_lines</span><span class="p">(</span><span class="n">ply</span><span class="p">,</span> <span class="n">lines</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="n">has_quads</span><span class="p">(</span><span class="n">ply</span><span class="p">))</span> <span class="n">get_quads</span><span class="p">(</span><span class="n">ply</span><span class="p">,</span> <span class="n">quads</span><span class="p">);</span>
<span class="k">else</span> <span class="nf">get_triangles</span><span class="p">(</span><span class="n">ply</span><span class="p">,</span> <span class="n">triangles</span><span class="p">);</span>
</code></pre></div>
<h2 id="ply-writing">Ply writing</h2>
<p>Yocto/ModelIO defines several functions to make it easy to fill Ply data
to save to file. Since Ply properties cane be stored with many different
C types, the convenience functions maintain the same data type of the
data passed in without performing any conversion.</p>
<p>Use <code>add_value(ply, element, property, values)</code> to add the property values
stored them in the array <code>values</code>. The function returns whether or not
the property was successfully added. Since Ply properties are often stored together,
e.g. xyz coordinates, Yocto/ModelIO supports adding arrays of properties whose
values are packed in <code>vecXf</code>.
Use <code>add_values(ply, element, properties, values)</code> to add arrays of
properties.</p>
<p>For list properties, Yocto/ModelIO supports adding list properties as
arrays of arrays of dynamic size with <code>add_lists(ply,element,property,lists)</code>.
A faster, but harder to use, method is to add lists sizes and values as
separate arrays, where list values are packed together to avoid small memory
allocations. Use <code>add_lists(ply, element, property, sizes, values)</code>.
Finally, Yocto/ModelIO supports adding lists of fixed lengths, where the
parameters are packed into <code>vecXi</code>,
with <code>add_lists(ply,element,property,values)</code>.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">ply</span> <span class="o">=</span> <span class="n">ply_model</span><span class="p">{};</span>               <span class="c1">// ply model buffer</span>

<span class="k">auto</span> <span class="n">radius</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">{...};</span>                <span class="c1">// property buffer</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">add_value</span><span class="p">(</span><span class="n">ply</span><span class="p">,</span> <span class="s">&quot;vertex&quot;</span><span class="p">,</span> <span class="s">&quot;radius&quot;</span><span class="p">,</span> <span class="n">radius</span><span class="p">))</span>  <span class="c1">// add property</span>
  <span class="n">print_error</span><span class="p">(</span><span class="s">&quot;error in radius&quot;</span><span class="p">);</span>                <span class="c1">// error if missing</span>
<span class="k">auto</span> <span class="n">positions</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec3f</span><span class="o">&gt;</span><span class="p">{...};</span>             <span class="c1">// properties buffer</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">add_values</span><span class="p">(</span><span class="n">ply</span><span class="p">,</span> <span class="s">&quot;vertex&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="s">&quot;y&quot;</span><span class="p">,</span><span class="s">&quot;z&quot;</span><span class="p">},</span> <span class="n">positions</span><span class="p">))</span> <span class="c1">// add properties</span>
  <span class="n">print_error</span><span class="p">(</span><span class="s">&quot;missing positions&quot;</span><span class="p">);</span>              <span class="c1">// error if missing</span>

<span class="k">auto</span> <span class="n">faces</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span><span class="p">{...};</span>           <span class="c1">// list property buffer</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">add_lists</span><span class="p">(</span><span class="n">ply</span><span class="p">,</span> <span class="s">&quot;face&quot;</span><span class="p">,</span> <span class="s">&quot;indices&quot;</span><span class="p">,</span> <span class="n">faces</span><span class="p">))</span>    <span class="c1">// add lists</span>
  <span class="n">print_error</span><span class="p">(</span><span class="s">&quot;missing faces&quot;</span><span class="p">);</span>                  <span class="c1">// error if missing</span>

<span class="k">auto</span> <span class="n">faces_sizes</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{...};</span>             <span class="c1">// list property sizes</span>
<span class="k">auto</span> <span class="n">faces_values</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{...};</span>            <span class="c1">// list property values</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">add_lists</span><span class="p">(</span><span class="n">ply</span><span class="p">,</span> <span class="s">&quot;face&quot;</span><span class="p">,</span> <span class="s">&quot;indices&quot;</span><span class="p">,</span> <span class="n">faces_sizes</span><span class="p">,</span> <span class="n">face_values</span><span class="p">))</span> <span class="c1">// add lists</span>
  <span class="n">print_error</span><span class="p">(</span><span class="s">&quot;missing faces&quot;</span><span class="p">);</span>                  <span class="c1">// error if missing</span>

<span class="k">auto</span> <span class="n">triangles</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec3i</span><span class="o">&gt;</span><span class="p">{...};</span>             <span class="c1">// fixed length list property</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">add_lists</span><span class="p">(</span><span class="n">ply</span><span class="p">,</span> <span class="s">&quot;face&quot;</span><span class="p">,</span> <span class="s">&quot;indices&quot;</span><span class="p">,</span> <span class="n">triangles</span><span class="p">))</span><span class="c1">// add lists</span>
  <span class="n">print_error</span><span class="p">(</span><span class="s">&quot;missing faces&quot;</span><span class="p">);</span>                  <span class="c1">// error if missing</span>

<span class="k">auto</span> <span class="n">error</span> <span class="o">=</span> <span class="n">string</span><span class="p">{};</span>                  <span class="c1">// error buffer</span>
<span class="n">save_ply</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">ply</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>         <span class="c1">// save ply</span>
</code></pre></div>
<p>Yocto/ModelIO defines convenience functions to add the most used properties
of meshes, using standard element and property names.
For vertex properties, use <code>add_positions(ply, positions)</code>,
<code>add_normals(ply, normals)</code>, <code>add_texcoords(ply, texcoords, flipv)</code>,
<code>add_colors(ply, colors)</code>, and <code>add_radius(ply, radius)</code> to read positions,
normals, texcoords, colors and radius if present. Texture coordinates can be
optionally flipped vertically. For shape elements, use
<code>add_points(ply, points)</code>, <code>add_lines(ply, lines)</code>,
<code>add_triangles(ply, triangles)</code>, and <code>add_quads(ply, quads)</code>, to add
points, lines, triangles and quads. Use <code>add_faces(ply, faces)</code> to add
arbitrary polygonal faces.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">ply</span> <span class="o">=</span> <span class="n">ply_model</span><span class="p">{};</span>                 <span class="c1">// ply model buffer</span>

<span class="k">auto</span> <span class="n">positions</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec3f</span><span class="o">&gt;</span><span class="p">{...};</span>    <span class="c1">// vertex properties buffers</span>
<span class="k">auto</span> <span class="n">normals</span>   <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec3f</span><span class="o">&gt;</span><span class="p">{...};</span>
<span class="k">auto</span> <span class="n">texcoords</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec2f</span><span class="o">&gt;</span><span class="p">{...};</span>
<span class="k">auto</span> <span class="n">colors</span>    <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec3f</span><span class="o">&gt;</span><span class="p">{...};</span>
<span class="k">auto</span> <span class="n">radius</span>    <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">{...};</span>
<span class="n">add_positions</span><span class="p">(</span><span class="n">ply</span><span class="p">,</span> <span class="n">positions</span><span class="p">);</span>          <span class="c1">// add vertex props.</span>
<span class="n">add_normals</span><span class="p">(</span><span class="n">ply</span><span class="p">,</span> <span class="n">normals</span><span class="p">);</span>
<span class="n">add_texcoords</span><span class="p">(</span><span class="n">ply</span><span class="p">,</span> <span class="n">texcoords</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>   <span class="c1">// last params, flips y is desired</span>
<span class="n">add_colors</span><span class="p">(</span><span class="n">ply</span><span class="p">,</span> <span class="n">colors</span><span class="p">);</span>
<span class="n">add_radius</span><span class="p">(</span><span class="n">ply</span><span class="p">,</span> <span class="n">radius</span><span class="p">);</span>

<span class="k">auto</span> <span class="n">points</span>    <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec4i</span><span class="o">&gt;</span><span class="p">{...};</span>    <span class="c1">// shape elements buffers</span>
<span class="k">auto</span> <span class="n">lines</span>     <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec4i</span><span class="o">&gt;</span><span class="p">{...};</span>
<span class="k">auto</span> <span class="n">triangles</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec4i</span><span class="o">&gt;</span><span class="p">{...};</span>
<span class="k">auto</span> <span class="n">quads</span>     <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec4i</span><span class="o">&gt;</span><span class="p">{...};</span>
<span class="n">add_points</span><span class="p">(</span><span class="n">ply</span><span class="p">,</span> <span class="n">points</span><span class="p">);</span>                <span class="c1">// add shape elements</span>
<span class="n">add_lines</span><span class="p">(</span><span class="n">ply</span><span class="p">,</span> <span class="n">lines</span><span class="p">);</span>
<span class="n">add_triangles</span><span class="p">(</span><span class="n">ply</span><span class="p">,</span> <span class="n">triangles</span><span class="p">);</span>
<span class="n">add_quads</span><span class="p">(</span><span class="n">ply</span><span class="p">,</span> <span class="n">quads</span><span class="p">);</span>

<span class="k">auto</span> <span class="n">error</span> <span class="o">=</span> <span class="n">string</span><span class="p">{};</span>                  <span class="c1">// error buffer</span>
<span class="n">save_ply</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">ply</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>         <span class="c1">// save ply</span>
</code></pre></div>
<h2 id="obj-models">Obj models</h2>
<p>The Obj file format is a file format used to serialize meshes and materials.
To use this library is helpful to understand the basic of the Obj
file format for example from the
<a href="https://en.wikipedia.org/wiki/OBJ_(file_format)">Obj Wikipedia page</a>.
Obj files come in pairs, <code>.obj</code> for shapes and <code>.mtl</code> for materials.</p>
<p>Yocto/ModelIO represents Obj data with the <code>obj_model</code> struct.
Obj models are defined as collections of shapes and materials.
Obj shapes use a face-varying representation that has vertex positions,
normals and texture coordinates, with their their own topology.
In a shape, each face is tagged with a material used for that face.
Yocto/ModelIO provides direct access to these tagged shapes by inspecting the
<code>obj_shape</code> properties.</p>
<p>In Yocto/Obj, materials are represented by the <code>obj_material</code> struct.
Each material is a collection of values and textures that specify the material
lobes, like emission, diffuse, specular, reflection, etc. Each value
has a corresponding texture stored as an index to the texture array.</p>
<p>Yocto/ModelIO defines two extensions to the Obj file format.
Yocto/ModelIO adds another file, namely <code>.obx</code>, that stores cameras and
environment maps, respectively as <code>obj_camera</code> and <code>obj_environment</code>. T
his addition makes the extended Obj format capable of storing full scenes.</p>
<p>The Obj model is defined as an array of objects of the types defined above.
Obj objects are pointers owned by the main <code>obj_model</code>.
Objects properties can be read and written directly from the model data,
and are documented in the header file for now.
For shapes, Yocto/ModelIO provides several functions to read and write Obj
shapes, with a simpler interface than accessing data directly.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">obj_model</span><span class="p">{...};</span>                <span class="c1">// obj model buffer</span>
<span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">shape</span> <span class="p">:</span> <span class="n">obj</span><span class="p">.</span><span class="n">shapes</span><span class="p">)</span>              <span class="c1">// access shapes</span>
  <span class="n">print_info</span><span class="p">(</span><span class="n">shape</span><span class="p">.</span><span class="n">name</span><span class="p">);</span>                 <span class="c1">// access shape properties</span>
<span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">material</span> <span class="p">:</span> <span class="n">obj</span><span class="p">.</span><span class="n">material</span><span class="p">)</span>         <span class="c1">// access materials</span>
  <span class="n">print_info</span><span class="p">(</span><span class="n">material</span><span class="p">.</span><span class="n">diffuse</span><span class="p">);</span>           <span class="c1">// access material properties</span>
<span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">material</span> <span class="p">:</span> <span class="n">obj</span><span class="p">.</span><span class="n">material</span><span class="p">)</span>         <span class="c1">// access materials</span>
  <span class="n">print_info</span><span class="p">(</span><span class="n">material</span><span class="p">.</span><span class="n">diffuse_tex</span><span class="p">);</span>       <span class="c1">// access material textures</span>
<span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">camera</span> <span class="p">:</span> <span class="n">obj</span><span class="p">.</span><span class="n">cameras</span><span class="p">)</span>            <span class="c1">// access cameras [extension]</span>
  <span class="n">print_info</span><span class="p">(</span><span class="n">camera</span><span class="p">.</span><span class="n">frame</span><span class="p">);</span>               <span class="c1">// access camera properties</span>
<span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">environment</span> <span class="p">:</span> <span class="n">obj</span><span class="p">.</span><span class="n">environments</span><span class="p">)</span>  <span class="c1">// access environments [extension]</span>
  <span class="n">print_info</span><span class="p">(</span><span class="n">environment</span><span class="p">.</span><span class="n">emission</span><span class="p">);</span>       <span class="c1">// access environment properties</span>
</code></pre></div>
<p>Use <code>load_obj(filename, obj)</code> or <code>obj = load_obj(filename)</code> to load Obj files
and <code>save_obj(filename, obj)</code> to save them.
Both loading and saving take a filename, a reference to a model, and throw 
an exception <code>io_error</code> exception if the file was not loaded successfully.
Use without exception is supported as described above.</p>
<p>Obj is a face-varying file format, while most applications handle only
indexed meshes. The loading function takes an optional that specify whether
to load as face-varying or convert to indexed meshes, which is the default.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">obj_model</span><span class="p">{};</span>        <span class="c1">// obj model</span>
<span class="n">load_obj</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">obj</span><span class="p">);</span>       <span class="c1">// load obj as indexed meshes</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">load_obj</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>      <span class="c1">// alternative load</span>
<span class="n">load_obj</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span> <span class="c1">// load obj as face-varying</span>
<span class="n">save_obj</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">obj</span><span class="p">);</span>       <span class="c1">// save obj</span>
</code></pre></div>
<p>It is common in graphics to use Obj file to store single meshes. Yocto/Obj
supports this modality by providing specialized loading and saving functions
that take references to shapes as parameters.
Use <code>load_obj(filename, shape)</code> or <code>shape = load_sobj(filename)</code> to load Obj 
shapes and <code>save_obj(filename, shape)</code> to save them. The loading function takes
an optional that specify whether to load as face-varying or convert to
indexed meshes, which is the default.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">shape</span> <span class="o">=</span> <span class="n">obj_shape</span><span class="p">{};</span>        <span class="c1">// obj shape</span>
<span class="n">load_obj</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>        <span class="c1">// load obj as indexed meshes</span>
<span class="n">shape</span> <span class="o">=</span> <span class="n">load_sobj</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>     <span class="c1">// alternative load</span>
<span class="n">load_obj</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span> <span class="c1">// load obj as face-varying</span>
<span class="n">save_obj</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">shape</span><span class="p">);</span>       <span class="c1">// save obj</span>
</code></pre></div>
<h2 id="obj-reading">Obj reading</h2>
<p>Obj is a face-varying format and that geometry representation is maintained
in <code>obj_shape</code>. Yocto/ModelIO provides easier accessed to Obj shape data,
both as indexed meshes and as face-varying meshes.</p>
<p>Use <code>get_positions(shape, positions)</code>, <code>get_normals(shape, normals)</code>,
<code>get_texcoords(shape, texcoords, flipv)</code>, to read positions,
normals, texcoords, if present. Texture coordinates can be
optionally flipped vertically. For shape elements, use
<code>get_points(shape, points, materials)</code>, <code>get_lines(shape, lines, materials)</code>,
<code>get_triangles(shape, triangles, materials)</code>, and
<code>get_quads(shape, quads, materials)</code>, to read points, lines, triangles and quads.
Note that since Obj support arbitrary polygons and polylines, these functions
tesselate the Obj polygons into the desired element type, for now using a
simple fan-like algorithm that works only for convex elements.
Use <code>has_quads(shape)</code> to check whether the Obj data has quads,
or use <code>get_faces(shape, triangles, quads, materials)</code> to triangles or quads.</p>
<p>In some cases, it may be desireable to extract the shape elements corresponding
to a single material, for example for use in renderers that support a single
shader per shape. To filtering elements by material index use
<code>get_points(shape, material, points)</code>, <code>get_lines(shape, material, lines)</code>,
<code>get_triangles(shape, material, triangles)</code>, and <code>get_quads(shape, material, quads)</code>.
that are overrides of the previous <code>get_&lt;element&gt;(...)</code> functions,
but differ in that they take a material is as input, instead of returning
materials tags.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">obj_model</span><span class="p">{};</span>                <span class="c1">// obj model buffer</span>
<span class="n">load_obj</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">obj</span><span class="p">);</span>               <span class="c1">// load obj</span>
<span class="k">auto</span><span class="o">&amp;</span> <span class="n">shape</span> <span class="o">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">shapes</span><span class="p">.</span><span class="n">front</span><span class="p">();</span>      <span class="c1">// get shape</span>

<span class="k">auto</span> <span class="n">positions</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec3f</span><span class="o">&gt;</span><span class="p">{};</span>      <span class="c1">// vertex properties</span>
<span class="n">get_positions</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">positions</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">normals</span>   <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec3f</span><span class="o">&gt;</span><span class="p">{};</span>
<span class="n">get_normals</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">normals</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">texcoords</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec2f</span><span class="o">&gt;</span><span class="p">{};</span>
<span class="n">get_texcoords</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">texcoords</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">triangles</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec3i</span><span class="o">&gt;</span><span class="p">{};</span>      <span class="c1">// element data</span>
<span class="k">auto</span> <span class="n">quads</span>     <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec4i</span><span class="o">&gt;</span><span class="p">{};</span>
<span class="k">auto</span> <span class="n">materials</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{};</span>        <span class="c1">// per-face material ids</span>
<span class="k">if</span><span class="p">(</span><span class="n">has_quads</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span> <span class="p">{</span>
  <span class="n">get_triangles</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">triangles</span><span class="p">,</span> <span class="n">materials</span><span class="p">);</span> <span class="c1">// read as triangles</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="n">get_quads</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">quads</span><span class="p">,</span> <span class="n">materials</span><span class="p">);</span>   <span class="c1">// read as quads</span>
<span class="p">}</span>

<span class="k">auto</span> <span class="n">material_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>                     <span class="c1">// material id to extract to</span>
<span class="k">if</span><span class="p">(</span><span class="n">has_quads</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span> <span class="p">{</span>
  <span class="n">get_triangles</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">material_id</span><span class="p">,</span> <span class="n">triangles</span><span class="p">);</span> <span class="c1">// read as triangles</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="n">get_quads</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">material_id</span><span class="p">,</span> <span class="n">quads</span><span class="p">);</span>   <span class="c1">// read as quads</span>
<span class="p">}</span>
</code></pre></div>
<p>Yocto/ModelIO supports also reading Obj shapes as face-varying quads
with <code>get_fvquads(...)</code>. In this case, the model should be loaded as
face-varying.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="n">obj_model</span><span class="p">{};</span>             <span class="c1">// obj model buffer</span>
<span class="n">load_obj</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>          <span class="c1">// load obj as face-varying</span>
<span class="k">auto</span><span class="o">&amp;</span> <span class="n">shape</span> <span class="o">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">shapes</span><span class="p">.</span><span class="n">front</span><span class="p">();</span>       <span class="c1">// get shape</span>

<span class="k">auto</span> <span class="n">positions</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec3f</span><span class="o">&gt;</span><span class="p">{};</span>       <span class="c1">// vertex properties</span>
<span class="n">get_positions</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">positions</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">normals</span>   <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec3f</span><span class="o">&gt;</span><span class="p">{};</span>
<span class="n">get_normals</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">normals</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">texcoords</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec2f</span><span class="o">&gt;</span><span class="p">{};</span>
<span class="n">get_texcoords</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">texcoords</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">quadspos</span>  <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec4i</span><span class="o">&gt;</span><span class="p">{};</span>       <span class="c1">// face-varying element data</span>
<span class="k">auto</span> <span class="n">quadsnorm</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec4i</span><span class="o">&gt;</span><span class="p">{};</span>
<span class="k">auto</span> <span class="n">quadsuv</span>   <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec4i</span><span class="o">&gt;</span><span class="p">{};</span>
<span class="k">auto</span> <span class="n">materials</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{};</span>         <span class="c1">// per-face material ids</span>
<span class="n">get_fvquads</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span>                      <span class="c1">// read as face-varying quads</span>
  <span class="n">quadspos</span><span class="p">,</span> <span class="n">quadsnorm</span><span class="p">,</span> <span class="n">quadsuv</span><span class="p">,</span> <span class="n">materias</span><span class="p">);</span>
</code></pre></div>
<h2 id="obj-writing">Obj writing</h2>
<p>To save an Obj, create a scene and add objects to it by manipulating the
objects' arrays directly. For all objects, set the objects' properties directly.</p>
<p>For shapes, Yocto/ModelIO defines convenience functions that take either
indexed mesh or face-varying meshes as input and create the appropriate
Obj shape elements. Use <code>add_positions(shape, positions)</code>,
<code>add_normals(shape, normals)</code> and <code>add_texcoords(shape, texcoords, flipv)</code>
to add vertex properties to a shape.
Use <code>add_triangles(shape, triangles, material, has_normals, has_texcoords)</code>,
<code>add_quads(shape, quads, material, has_normals, has_texcoords)</code>,
<code>add_lines(shape, lines, material, has_normals, has_texcoords)</code>,
<code>add_points(shape, points, material, has_normals, has_texcoords)</code>
to add triangles, quads, lines or points to shapes respectively.
Material data is only represented as tags and can be left
empty if only one material is used. To set material names
use <code>set_materials(shape, materials)</code>.
To add face-varying shapes, use <code>add_fvquads(...)</code>.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">obj</span> <span class="o">=</span>  <span class="n">obj_model</span><span class="p">{};</span>                 <span class="c1">// obj model</span>

<span class="k">auto</span> <span class="n">camera</span> <span class="o">=</span> <span class="n">obj_camera</span><span class="p">{};</span>              <span class="c1">// init camera</span>
<span class="n">camera</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;camera&quot;</span><span class="p">;</span>                  <span class="c1">// set camera name</span>
<span class="n">camera</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">identity3x4f</span><span class="p">;</span>             <span class="c1">// set camera properties</span>
<span class="n">obj</span><span class="p">.</span><span class="n">cameras</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">camera</span><span class="p">);</span>           <span class="c1">// add camera</span>
<span class="k">auto</span> <span class="n">environment</span> <span class="o">=</span> <span class="n">add_environment</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span> <span class="c1">// init environment</span>
<span class="n">environment</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;environment&quot;</span><span class="p">;</span>        <span class="c1">// set environment name</span>
<span class="n">environment</span><span class="p">.</span><span class="n">emission</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">};</span>          <span class="c1">// set environment properties</span>
<span class="n">obj</span><span class="p">.</span><span class="n">environments</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">environment</span><span class="p">);</span> <span class="c1">// add environment</span>
<span class="k">auto</span> <span class="n">material</span> <span class="o">=</span> <span class="n">add_material</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span>       <span class="c1">// init material</span>
<span class="n">material</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;material&quot;</span><span class="p">;</span>              <span class="c1">// set material name</span>
<span class="n">material</span><span class="p">.</span><span class="n">diffuse</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">};</span>              <span class="c1">// set material properties</span>
<span class="n">obj</span><span class="p">.</span><span class="n">materials</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">material</span><span class="p">);</span>       <span class="c1">// add material</span>

<span class="k">auto</span> <span class="n">triangles</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec3i</span><span class="o">&gt;</span><span class="p">{...};</span>     <span class="c1">// element data</span>
<span class="k">auto</span> <span class="n">positions</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec3f</span><span class="o">&gt;</span><span class="p">{...};</span>     <span class="c1">// vertex properties</span>
<span class="k">auto</span> <span class="n">normals</span>   <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec3f</span><span class="o">&gt;</span><span class="p">{...};</span>
<span class="k">auto</span> <span class="n">texcoords</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec2f</span><span class="o">&gt;</span><span class="p">{...};</span>

<span class="k">auto</span> <span class="n">shape</span> <span class="o">=</span> <span class="n">obj_shape</span><span class="p">{};</span>                <span class="c1">// init shape</span>
<span class="n">shape</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;shape&quot;</span><span class="p">;</span>                    <span class="c1">// set shape name</span>
<span class="n">add_triangles</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">triangles</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>      <span class="c1">// set shape geometry</span>
<span class="n">add_positions</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">positions</span><span class="p">);</span>
<span class="n">add_normals</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">normals</span><span class="p">);</span>
<span class="n">add_texcoords</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">texcoords</span><span class="p">);</span>

<span class="k">auto</span> <span class="n">error</span> <span class="o">=</span> <span class="n">string</span><span class="p">{};</span>                  <span class="c1">// error buffer</span>
<span class="n">save_obj</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>         <span class="c1">// save obj</span>
</code></pre></div>
<p>And similarly for face-varying shapes.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">obj_model</span><span class="p">{};</span>                 <span class="c1">// obj model buffer</span>

<span class="k">auto</span> <span class="n">quadspos</span>  <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec4i</span><span class="o">&gt;</span><span class="p">{...};</span>    <span class="c1">// face-varying element data</span>
<span class="k">auto</span> <span class="n">quadsnorm</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec4i</span><span class="o">&gt;</span><span class="p">{...};</span>
<span class="k">auto</span> <span class="n">quadsuv</span>   <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec4i</span><span class="o">&gt;</span><span class="p">{...};</span>
<span class="k">auto</span> <span class="n">positions</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec3f</span><span class="o">&gt;</span><span class="p">{...};</span>    <span class="c1">// vertex properties</span>
<span class="k">auto</span> <span class="n">normals</span>   <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec3f</span><span class="o">&gt;</span><span class="p">{...};</span>
<span class="k">auto</span> <span class="n">texcoords</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec2f</span><span class="o">&gt;</span><span class="p">....{};</span>

<span class="k">auto</span> <span class="n">shape</span> <span class="o">=</span> <span class="n">obj_shape</span><span class="p">{};</span>               <span class="c1">// add shape</span>
<span class="n">shape</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;shape&quot;</span><span class="p">;</span>                   <span class="c1">// set shape name</span>
<span class="n">add_fvquads</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">quadspos</span><span class="p">,</span>            <span class="c1">// set shape geometry</span>
  <span class="n">quadsnorm</span><span class="p">,</span> <span class="n">quadstexcoord</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">add_positions</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">positions</span><span class="p">);</span>
<span class="n">add_normals</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">normals</span><span class="p">);</span>
<span class="n">add_texcoords</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">texcoords</span><span class="p">);</span>

<span class="n">save_obj</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">obj</span><span class="p">);</span>                <span class="c1">// save obj</span>
</code></pre></div>
<h2 id="stl-models">Stl models</h2>
<p>The Stl file format is a file format used to serialize meshes.
To use this library is helpful to understand the basic of the Stl
file format for example from the
<a href="https://en.wikipedia.org/wiki/STL_(file_format)">Stl Wikipedia page</a>.</p>
<p>Yocto/ModelIO represents Stl data with the <code>stl_model</code> struct.
Stl models are defined as collections of shapes, stored in <code>stl_shape</code>.
Shapes are defined by an array of vertex positions, an array of triangle
indices, and an array of triangle normals.</p>
<p>Use <code>load_stl(filename, stl)</code> or <code>stl = load_stl(filename)</code> to load Stl files
and <code>save_stl(filename, stl)</code> to save them.
Both loading and saving take a filename, a reference to a model, and throw 
an exception <code>io_error</code> exception if the file was not loaded successfully.
Use without exception is supported as described above.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">stl</span> <span class="o">=</span> <span class="n">stl_model</span><span class="p">{};</span>        <span class="c1">// stl model</span>
<span class="n">load_stl</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">stl</span><span class="p">);</span>       <span class="c1">// load stl</span>
<span class="n">stl</span> <span class="o">=</span> <span class="n">load_stl</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>      <span class="c1">// alternative load</span>
<span class="n">save_stl</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">stl</span><span class="p">);</span>       <span class="c1">// save stl</span>
</code></pre></div>
<h2 id="stl-reading">Stl reading</h2>
<p>You can access Stl data directly from the shapes, without any further complexity.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">stl</span> <span class="o">=</span> <span class="n">stl_model</span><span class="p">{};</span>                <span class="c1">// stl model buffer</span>
<span class="n">load_obj</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">stl</span><span class="p">);</span>               <span class="c1">// load stl</span>
<span class="k">auto</span><span class="o">&amp;</span> <span class="n">shape</span> <span class="o">=</span> <span class="n">stl</span><span class="p">.</span><span class="n">shapes</span><span class="p">.</span><span class="n">front</span><span class="p">();</span>      <span class="c1">// get shape</span>

<span class="k">auto</span> <span class="n">positions</span> <span class="o">=</span> <span class="n">shape</span><span class="p">.</span><span class="n">positions</span><span class="p">;</span>      <span class="c1">// vertex properties</span>
<span class="k">auto</span> <span class="n">triangles</span> <span class="o">=</span> <span class="n">shape</span><span class="p">.</span><span class="n">triangles</span><span class="p">;</span>      <span class="c1">// element data</span>
</code></pre></div>
<h2 id="stl-writing">Stl writing</h2>
<p>Similarly, you can create an Stl model by acting directly on the data.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">stl</span> <span class="o">=</span> <span class="n">stl_model</span><span class="p">{};</span>                <span class="c1">// stl model buffer</span>
<span class="k">auto</span> <span class="n">shape</span> <span class="o">=</span> <span class="n">stl_shape</span><span class="p">{};</span>              <span class="c1">// create shape</span>
<span class="n">shape</span><span class="p">.</span><span class="n">positions</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec3f</span><span class="o">&gt;</span><span class="p">{...};</span>
<span class="n">shape</span><span class="p">.</span><span class="n">triangles</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec3i</span><span class="o">&gt;</span><span class="p">{...};</span>
<span class="n">stl</span><span class="p">.</span><span class="n">shapes</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">shape</span><span class="p">);</span>           <span class="c1">// add shape</span>
<span class="n">load_obj</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">stl</span><span class="p">);</span>               <span class="c1">// save stl</span>
</code></pre></div>
<h2 id="pbrt-models">Pbrt models</h2>
<p>The Pbrt file format is a scene representation suitable for realistic rendering
and implemented by the Pbrt renderer.
To use this library is helpful to understand the basic of the Pbrt
file format for example from the
<a href="https://www.pbrt.org/fileformat-v3.html">Pbrt format documentatioon</a>.</p>
<p>The Pbrt file format is an extensible file format for a plugin-based system.
Representing the format directly allows for best fidelity but pushed the burden
of interpreting standard plugins to the use. Yocto/ModelIO takes a different
approach and translates camera, shapes, materials, textures and lights from
Pbrt plugins to a common representation that presents users a simpler and
more uniform scene representation.</p>
<p>Yocto/ModelIO represents Pbrt data with the <code>pbrt_scene</code> struct.
Pbrt models are defined as collections of cameras, instanced shapes, materials,
texture and environments. Pbrt cameras are translate into a thin-len
approximations. Pbrt materials are translated to a material representation
similar to the Disney BSDF. Pbrt textures are either interpreted ion the fly or
defined by a image file. Pbrt area lights are translated to either emissive
materials and environments.</p>
<p>The Pbrt model is defined as an array of objects of the types defined above.
Pbrt objects are pointers owned by the main <code>pbrt_scene</code>.
Objects properties can be read and written directly from the model data,
and are documented in the header file for now.
Yocto/ModelIO does not currently provide functions to read and write Pbrt
shapes with a simpler interface than accessing data directly.</p>
<p>In general, Pbrt support is still experimental even if the library can
parse most Pbrt files. The objects properties documentations are for now
stored in the header file.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">pbrt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">pbrt_scene</span><span class="p">{...};</span>            <span class="c1">// obj model buffer</span>
<span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">shape</span> <span class="p">:</span> <span class="n">pbrt</span><span class="p">.</span><span class="n">shapes</span><span class="p">)</span>              <span class="c1">// access shapes</span>
  <span class="n">print_info</span><span class="p">(</span><span class="n">shape</span><span class="p">.</span><span class="n">name</span><span class="p">);</span>                  <span class="c1">// access shape properties</span>
<span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">material</span> <span class="p">:</span> <span class="n">pbrt</span><span class="p">.</span><span class="n">material</span><span class="p">)</span>         <span class="c1">// access materials</span>
  <span class="n">print_info</span><span class="p">(</span><span class="n">material</span><span class="p">.</span><span class="n">diffuse</span><span class="p">);</span>            <span class="c1">// access material properties</span>
<span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">material</span> <span class="p">:</span> <span class="n">pbrt</span><span class="p">.</span><span class="n">material</span><span class="p">)</span>         <span class="c1">// access materials</span>
  <span class="n">print_info</span><span class="p">(</span><span class="n">material</span><span class="p">.</span><span class="n">color_tex</span><span class="p">);</span>          <span class="c1">// access material textures</span>
<span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">camera</span> <span class="p">:</span> <span class="n">pbrt</span><span class="p">.</span><span class="n">cameras</span><span class="p">)</span>            <span class="c1">// access cameras [extension]</span>
  <span class="n">print_info</span><span class="p">(</span><span class="n">camera</span><span class="p">.</span><span class="n">frame</span><span class="p">);</span>                <span class="c1">// access camera properties</span>
<span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">environment</span> <span class="p">:</span> <span class="n">pbrt</span><span class="p">.</span><span class="n">environments</span><span class="p">)</span>  <span class="c1">// access environments [extension]</span>
  <span class="n">print_info</span><span class="p">(</span><span class="n">environment</span><span class="p">.</span><span class="n">emission</span><span class="p">);</span>        <span class="c1">// access environment properties</span>
</code></pre></div>
<p>Use <code>load_pbrt(filename, pbrt)</code> or <code>pbrt = load_pbrt(filename)</code> to load Pbrt 
files and <code>save_pbrt(filename, pbrt)</code> to save them.<br />
Both loading and saving take a filename, a reference to a model, and throw 
an exception <code>io_error</code> exception if the file was not loaded successfully.
Use without exception is supported as described above.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">pbrt</span> <span class="o">=</span> <span class="n">pbrt_scene</span><span class="p">{};</span>    <span class="c1">// pbrt model buffer</span>
<span class="n">load_pbrt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">pbrt</span><span class="p">);</span>   <span class="c1">// load pbrt</span>
<span class="n">pbrt</span> <span class="o">=</span> <span class="n">load_pbrt</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>  <span class="c1">// alternative load</span>
<span class="n">save_pbrt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">pbrt</span><span class="p">);</span>   <span class="c1">// save pbrt</span>
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../yocto_commonio/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Json and serialization utilities
            </div>
          </div>
        </a>
      
      
        <a href="../yocto_parallel/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Concurrency utilities
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2016 - 2020 Fabio Pellacini
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.fb4a9340.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.5cf3e710.min.js"></script>
      
    
  </body>
</html>