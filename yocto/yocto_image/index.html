
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <meta name="author" content="Fabio Pellacini">
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.0.5">
    
    
      
        <title>Image utilities - Yocto/GL</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.77f3fd56.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.7fa14f5b.min.css">
        
          
          
          <meta name="theme-color" content="#2094f3">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue" data-md-color-accent="">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#yoctoimage-image-utilities" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Yocto/GL" class="md-header__button md-logo" aria-label="Yocto/GL">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Yocto/GL
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Image utilities
            
          </span>
        </div>
      </div>
    </div>
    <div class="md-header__options">
      
    </div>
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/xelatihy/yocto-gl/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    xelatihy/yocto-gl
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Yocto/GL" class="md-nav__button md-logo" aria-label="Yocto/GL">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Yocto/GL
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/xelatihy/yocto-gl/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    xelatihy/yocto-gl
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../gallery/" class="md-nav__link">
        Gallery
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_math/" class="md-nav__link">
        Math types
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_color/" class="md-nav__link">
        Color operations
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_geometry/" class="md-nav__link">
        Geometry operations
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_sampling/" class="md-nav__link">
        Sampling routines
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_noise/" class="md-nav__link">
        Noise functions
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_shading/" class="md-nav__link">
        Shading routines
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Image utilities
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Image utilities
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#image-representation" class="md-nav__link">
    Image representation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#image-serialization" class="md-nav__link">
    Image serialization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#image-utilities" class="md-nav__link">
    Image utilities
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#procedural-images" class="md-nav__link">
    Procedural images
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#low-level-operations" class="md-nav__link">
    Low-level operations
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_shape/" class="md-nav__link">
        Shape utilities
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_mesh/" class="md-nav__link">
        Mesh processing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_scene/" class="md-nav__link">
        Scene representation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_bvh/" class="md-nav__link">
        Ray-scene intersection
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_trace/" class="md-nav__link">
        Path tracing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_cli/" class="md-nav__link">
        Command-line utilities
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_imageio/" class="md-nav__link">
        Image serialization
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_shapeio/" class="md-nav__link">
        Shape serialization
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_sceneio/" class="md-nav__link">
        Scene serialization
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_commonio/" class="md-nav__link">
        Json and serialization utilities
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_modelio/" class="md-nav__link">
        Model serialization
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_parallel/" class="md-nav__link">
        Concurrency utilities
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#image-representation" class="md-nav__link">
    Image representation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#image-serialization" class="md-nav__link">
    Image serialization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#image-utilities" class="md-nav__link">
    Image utilities
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#procedural-images" class="md-nav__link">
    Procedural images
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#low-level-operations" class="md-nav__link">
    Low-level operations
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="yoctoimage-image-utilities">Yocto/Image: Image utilities</h1>
<p>Yocto/Image is a collection of image utilities useful when writing rendering
algorithms. These include a simple image data structure, color conversion
utilities and tone mapping, and image resizing.
Yocto/Image is implemented in <code>yocto_image.h</code> and <code>yocto_image.cpp</code>, and
depends on <code>stb_image_resize.h</code>.</p>
<h2 id="image-representation">Image representation</h2>
<p>Images are represented as a simple struct called <code>image_data</code>, that stores
the image width and height, a boolean flat that indicates whether the colors
are in linear ot sRGB color space, and an array of pixels of <code>vec4f</code> type.</p>
<p>While images can be constructed by direct manipulation of their values,
th preferred way to construct images is by using the
<code>make_image(widgh, height, linear)</code> function, where colors are default
initialized to black.</p>
<p>Image pixels are stored in row-major order and be accessed with index
<code>j * width + i</code>. They can be conveniently accessed using <code>get_pixel(image,i,j)</code>
and <code>set_pixel(image,i,j,color)</code> function.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">image</span> <span class="o">=</span> <span class="n">make_image</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span><span class="mi">512</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span> <span class="c1">// creates a 512x512 sRGB image</span>
<span class="k">for</span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span> <span class="nl">pixel</span> <span class="p">:</span> <span class="n">image</span><span class="p">.</span><span class="n">pixels</span><span class="p">)</span>         <span class="c1">// iterate over pixels</span>
  <span class="n">print_info</span><span class="p">(</span><span class="n">pixel</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">color</span> <span class="o">=</span> <span class="n">get_pixel</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">);</span>  <span class="c1">// pixel access</span>
<span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">image</span><span class="p">.</span><span class="n">height</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>      <span class="c1">// iterate over image rows</span>
  <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">image</span><span class="p">.</span><span class="n">width</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>     <span class="c1">// iterate over row pixels</span>
    <span class="n">print_info</span><span class="p">(</span><span class="n">get_pixel</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">));</span>
</code></pre></div>
<p>Images are sampled with <code>eval_image(img,uv,...)</code>, where <code>uv</code> are in
the [0,1]x[0,1] range. By default, image values are returned in the color
space of the image, but can be forced to to be linear.
By default, images are sampled with bilinear interpolation and tiling,
with nearest-neighbor interpolation and edge-clamp behavior available
as overrides.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">hdr</span> <span class="o">=</span> <span class="n">make_image</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="nb">true</span><span class="p">);</span>        <span class="c1">// creates a linear image</span>
<span class="k">auto</span> <span class="n">ch0</span> <span class="o">=</span> <span class="n">eval_image</span><span class="p">(</span><span class="n">hdr</span><span class="p">,</span> <span class="p">{</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">});</span>  <span class="c1">// samples the image center</span>
<span class="k">auto</span> <span class="n">ch1</span> <span class="o">=</span> <span class="n">eval_image</span><span class="p">(</span><span class="n">hdr</span><span class="p">,</span> <span class="p">{</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">},</span> <span class="nb">false</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>  <span class="c1">// no interpolation</span>
<span class="k">auto</span> <span class="n">ch2</span> <span class="o">=</span> <span class="n">eval_image</span><span class="p">(</span><span class="n">hdr</span><span class="p">,</span> <span class="p">{</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">},</span> <span class="nb">false</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>  <span class="c1">// clamp to edge</span>
<span class="k">auto</span> <span class="n">ldr</span> <span class="o">=</span> <span class="n">make_image</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>       <span class="c1">// creates a sRGB image</span>
<span class="k">auto</span> <span class="n">ch0</span> <span class="o">=</span> <span class="n">eval_image</span><span class="p">(</span><span class="n">ldr</span><span class="p">,</span> <span class="p">{</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">});</span>  <span class="c1">// samples in sRGB, returns as sRGB</span>
<span class="k">auto</span> <span class="n">ch1</span> <span class="o">=</span> <span class="n">eval_image</span><span class="p">(</span><span class="n">ldr</span><span class="p">,</span> <span class="p">{</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">},</span> <span class="nb">true</span><span class="p">);</span>  <span class="c1">// treats sRGB values as linear</span>
</code></pre></div>
<h2 id="image-serialization">Image serialization</h2>
<p>Image loading and saving is defined in <a href="../yocto_imageio/">Yocto/ImageIO</a>.</p>
<h2 id="image-utilities">Image utilities</h2>
<p>Images can be converted between linear RGB and sRGB color space using
<code>convert_image(image,linear)</code>.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">linear</span> <span class="o">=</span> <span class="n">make_image</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="nb">true</span><span class="p">);</span>   <span class="c1">// initialize a linear image</span>
<span class="k">auto</span> <span class="n">srgb</span> <span class="o">=</span> <span class="n">convert_image</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span> <span class="c1">// convert to sRGB</span>
</code></pre></div>
<p>HDR images can be tone mapped using <code>tonemap_image(hdr,exposure,filmic)</code>
that applies an exposure correction followed by an optional filmic tone curve.
Use <code>tonemap_image_mt(...)</code> to quickly tone map large images using
multiple threads.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">hdr</span> <span class="o">=</span> <span class="n">make_image</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="nb">true</span><span class="p">);</span>         <span class="c1">// initialize am HDR image</span>
<span class="k">auto</span> <span class="n">ldr</span> <span class="o">=</span> <span class="n">tonemap_image</span><span class="p">(</span><span class="n">hdr</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>        <span class="c1">// tone mapping with exposure 2</span>
<span class="k">auto</span> <span class="n">flm</span> <span class="o">=</span> <span class="n">tonemap_image</span><span class="p">(</span><span class="n">hdr</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>  <span class="c1">// filmic tone mapping</span>
</code></pre></div>
<p>Images can be color graded by applying a set of minimal color grading tools
using <code>colorgrade_image(image,params)</code>, in manner similar to
<a href="http://filmicworlds.com/blog/minimal-color-grading-tools/">Hable 2017</a>.
Color grading corrections can be applied on images that are either linear HDR
or sRGB encoded. The results is always an LDR image encoded in sRGB.
Use <code>colorgrade_image_mt(...)</code> to quickly tone map large images using
multiple threads.</p>
<p>Several color corrections are bundled together with their parameters
packed in a convenience structure <code>colorgrade_params</code>.
Color grading operations are applied in a fixed sequence and consist of the
following operations: exposure compensation, color tint, contrast in the log domain,
filmic curve, conversion to sRGB, S-shaped contrast, saturation,
and shadow/midtone/highlight correction.
Color tinting can be used to apply white balance by using
<code>compute_white_balance(img)</code> to determine the correct color.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">hdr</span> <span class="o">=</span> <span class="n">make_image</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="nb">true</span><span class="p">);</span>         <span class="c1">// initialize an HDR image</span>
<span class="k">auto</span> <span class="n">params</span> <span class="o">=</span> <span class="n">colorgrade_params</span><span class="p">{};</span>       <span class="c1">// default color grading params</span>
<span class="n">params</span><span class="p">.</span><span class="n">exposure</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>                     <span class="c1">// set desired params</span>
<span class="n">params</span><span class="p">.</span><span class="n">logcontrast</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">;</span>               <span class="c1">// set desired params</span>
<span class="n">params</span><span class="p">.</span><span class="n">tint</span> <span class="o">=</span> <span class="n">compute_white_balance</span><span class="p">(</span><span class="n">hdr</span><span class="p">);</span><span class="c1">// apply white balance</span>
<span class="k">auto</span> <span class="n">ldr</span> <span class="o">=</span> <span class="n">colorgrade_image</span><span class="p">(</span><span class="n">hdr</span><span class="p">,</span> <span class="n">params</span><span class="p">);</span><span class="c1">// color grading</span>
</code></pre></div>
<p>Images are can resized with <code>resize_image(image,w,h)</code>. Just like all other
functions, images are not resized in placed, but a new image is created.
Resizing works for both linear and 8bit images.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">img</span> <span class="o">=</span> <span class="n">make_image</span><span class="p">(...);</span>              <span class="c1">// initialize an image</span>
<span class="k">auto</span> <span class="n">res</span> <span class="o">=</span> <span class="n">resize_image</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">);</span>  <span class="c1">// resizing to fixed size</span>
<span class="k">auto</span> <span class="n">asp</span> <span class="o">=</span> <span class="n">resize_image</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>    <span class="c1">// aspect-preserving</span>
</code></pre></div>
<p>Image differences can be computed using <code>image_difference(a,b)</code>. This function
performs a simple per-pixel difference and returns the image so that one can
use any metric to determine whether images where different within some threshold.
Optionally, a difference image is returned that highlights the diff.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">a</span> <span class="o">=</span> <span class="n">make_image</span><span class="p">(...),</span> <span class="n">b</span> <span class="o">=</span> <span class="n">make_image</span><span class="p">(...);</span> <span class="c1">// init images</span>
<span class="k">auto</span> <span class="n">diff</span> <span class="o">=</span> <span class="n">image_difference</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>            <span class="c1">// image difference</span>
<span class="k">auto</span> <span class="n">display</span> <span class="o">=</span> <span class="n">image_difference</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">nb</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>   <span class="c1">// diff display</span>
</code></pre></div>
<h2 id="procedural-images">Procedural images</h2>
<p>Yocto/Image defines several procedural images used for both testing and to
quickly create textures for procedural scenes. Testing patterns take as input
the desired image size, the pattern scale, and optionally two colors to
interpolate between. Use <code>make_grid(...)</code> for a grid image,
<code>make_checker(...)</code> for a checker, <code>make_bumps(...)</code> for a bumpy test,
<code>make_ramp(...)</code> for a linear ramp, <code>make_gammaramp(...)</code> for a ramp with
different gamma settings, <code>make_uvramp(...)</code> and <code>make_uvgrid(...)</code>
for test images for texture coordinates as either ramps or grids,
<code>make_colormapramp(...)</code> for a ramp to test different color maps, and
<code>make_blackbodyramp(...)</code> for a ramp with different blackbody temperatures.</p>
<p>Perlin noise patterns can be generated with <code>make_noisemap(...)</code>,
<code>make_fbmmap(...)</code>, <code>make_fbmmap(...)</code> and <code>make_fbmmap(...)</code>.
The latter three functions take as input the set of params that control
fractal variations. See <a href="../yocto_noise/">Yocto/Noise</a> for a description.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">;</span>                           <span class="c1">// image size</span>
<span class="k">auto</span> <span class="n">scale</span> <span class="o">=</span> <span class="kt">float</span><span class="p">{</span><span class="mi">1</span><span class="p">};</span>                             <span class="c1">// pattern scale</span>
<span class="k">auto</span> <span class="n">c0</span> <span class="o">=</span> <span class="n">vec4f</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">},</span> <span class="n">c1</span> <span class="o">=</span> <span class="n">vec4f</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">};</span>     <span class="c1">// colors</span>
<span class="k">auto</span> <span class="n">i1</span> <span class="o">=</span> <span class="n">make_grid</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">c1</span><span class="p">);</span>          <span class="c1">// grid image</span>
<span class="k">auto</span> <span class="n">i2</span> <span class="o">=</span> <span class="n">make_checker</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">c1</span><span class="p">);</span>       <span class="c1">// checker image</span>
<span class="k">auto</span> <span class="n">i3</span> <span class="o">=</span> <span class="n">make_bumps</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">c1</span><span class="p">);</span>         <span class="c1">// bumps image</span>
<span class="k">auto</span> <span class="n">i4</span> <span class="o">=</span> <span class="n">make_ramp</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">c1</span><span class="p">);</span>          <span class="c1">// ramp image</span>
<span class="k">auto</span> <span class="n">i5</span> <span class="o">=</span> <span class="n">make_gammaramp</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">c1</span><span class="p">);</span>     <span class="c1">// gamma ramp image</span>
<span class="k">auto</span> <span class="n">i6</span> <span class="o">=</span> <span class="n">make_uvramp</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">scale</span><span class="p">);</span>                <span class="c1">// uv ramp image</span>
<span class="k">auto</span> <span class="n">i7</span> <span class="o">=</span> <span class="n">make_uvgrid</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">scale</span><span class="p">);</span>                <span class="c1">// uv grid image</span>
<span class="k">auto</span> <span class="n">i8</span> <span class="o">=</span> <span class="n">make_colormapramp</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">scale</span><span class="p">);</span>          <span class="c1">// color map image</span>

<span class="k">auto</span> <span class="n">t0</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">t1</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">;</span>                        <span class="c1">// blackbody temperatures</span>
<span class="k">auto</span> <span class="n">b2</span> <span class="o">=</span> <span class="n">make_blackbodyramp</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">);</span> <span class="c1">// blackbody ramp image</span>

<span class="k">auto</span> <span class="n">noise</span> <span class="o">=</span> <span class="n">vec4f</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">};</span>                    <span class="c1">// noise params</span>
<span class="k">auto</span> <span class="n">n1</span> <span class="o">=</span> <span class="n">make_noisemap</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">noise</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">c1</span><span class="p">);</span> <span class="c1">// noise image</span>
<span class="k">auto</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">make_fbmmap</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">noise</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">c1</span><span class="p">);</span>   <span class="c1">// fbm image</span>
<span class="k">auto</span> <span class="n">n3</span> <span class="o">=</span> <span class="n">make_turbulencemap</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">noise</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">c1</span><span class="p">);</span><span class="c1">// turbulence image</span>
<span class="k">auto</span> <span class="n">n4</span> <span class="o">=</span> <span class="n">make_ridgemap</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">noise</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">c1</span><span class="p">);</span> <span class="c1">// ridge image</span>
</code></pre></div>
<p>Procedurals skies are generated with
<code>make_sunsky(img, w, h, elevation, turbidity, sun)</code>.
The function returns a procedural HDR sky.
The sun position is controlled by its <code>elevation</code> that is an angle in <code>[0,pi/2\]</code>.
The sky turbidity is controlled by the <code>turbidity</code> parameter that is defined in
the range <code>[1.7,10]</code>. The <code>sun</code> flag determines whether the sun disk is present
in the image. The function support optional parameters to control sun size and
intensity and ground albedo, mostly used for artistic effects.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">sky</span> <span class="o">=</span> <span class="n">make_sunsky</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>        <span class="c1">// clear sky</span>
<span class="k">auto</span> <span class="n">sun</span> <span class="o">=</span> <span class="n">make_sunsky</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>  <span class="c1">// clear sky with sun</span>
<span class="k">auto</span> <span class="n">tur</span> <span class="o">=</span> <span class="n">make_sunsky</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>       <span class="c1">// sky with turbidity</span>
</code></pre></div>
<p>Use <code>bump_to_normal(bumps)</code> to convert a bump map to a normal map, with both
images stored in a linear color spaces.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">bumps</span> <span class="o">=</span> <span class="n">make_bumps</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">);</span>    <span class="c1">// procedural bump map</span>
<span class="k">auto</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">bump_to_normal</span><span class="p">(</span><span class="n">bumps</span><span class="p">);</span>  <span class="c1">// convert bump map to normal map</span>
</code></pre></div>
<p>Finally, borders can be added to images using <code>add_border(img,width,color)</code>.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">bordered</span> <span class="o">=</span> <span class="n">add_border</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">});</span> <span class="c1">// add a thin black border</span>
</code></pre></div>
<h2 id="low-level-operations">Low-level operations</h2>
<p>Yocto/Image supports versions of the most of the above functions that work
directly on pixel arrays, rather than the image structure. This low-level
interface may be helpful when building applications that have their own
image data structure.</p>
<p>In this interface we support arrays of <code>vec4f</code> pixels together with arrays of
<code>vec4b</code> pixels for 8bit images, the latter with a much smaller number of
functions. In this case, the color space is handled in the application logic.
Conversion between color types is handled with <code>float_to_byte(pixels)</code>,
<code>byte_tyo_float(pixels)</code>, <code>rgb_to_srgb(pixels)</code> and <code>srgb_to_rgb(pixels)</code>.</p>
<p>Since most of these functions have signatures similar to the ones above, we
do not document here explicitly.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../yocto_shading/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Shading routines
            </div>
          </div>
        </a>
      
      
        <a href="../yocto_shape/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Shape utilities
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2016 - 2020 Fabio Pellacini
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.fb4a9340.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.5cf3e710.min.js"></script>
      
    
  </body>
</html>