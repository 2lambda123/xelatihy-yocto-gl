
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <meta name="author" content="Fabio Pellacini">
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.0.5">
    
    
      
        <title>Scene representation - Yocto/GL</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.77f3fd56.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.7fa14f5b.min.css">
        
          
          
          <meta name="theme-color" content="#2094f3">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue" data-md-color-accent="">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#yoctoscene-scene-representation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Yocto/GL" class="md-header__button md-logo" aria-label="Yocto/GL">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Yocto/GL
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Scene representation
            
          </span>
        </div>
      </div>
    </div>
    <div class="md-header__options">
      
    </div>
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/xelatihy/yocto-gl/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    xelatihy/yocto-gl
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Yocto/GL" class="md-nav__button md-logo" aria-label="Yocto/GL">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Yocto/GL
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/xelatihy/yocto-gl/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    xelatihy/yocto-gl
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../gallery/" class="md-nav__link">
        Gallery
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_math/" class="md-nav__link">
        Math types
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_color/" class="md-nav__link">
        Color operations
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_geometry/" class="md-nav__link">
        Geometry operations
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_sampling/" class="md-nav__link">
        Sampling routines
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_noise/" class="md-nav__link">
        Noise functions
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_shading/" class="md-nav__link">
        Shading routines
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_image/" class="md-nav__link">
        Image utilities
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_shape/" class="md-nav__link">
        Shape utilities
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_mesh/" class="md-nav__link">
        Mesh processing
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Scene representation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Scene representation
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#scene-representation" class="md-nav__link">
    Scene representation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cameras" class="md-nav__link">
    Cameras
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#instances" class="md-nav__link">
    Instances
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environments" class="md-nav__link">
    Environments
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shapes" class="md-nav__link">
    Shapes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#materials" class="md-nav__link">
    Materials
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#textures" class="md-nav__link">
    Textures
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#subdivs" class="md-nav__link">
    Subdivs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-scenes" class="md-nav__link">
    Example scenes
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_bvh/" class="md-nav__link">
        Ray-scene intersection
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_trace/" class="md-nav__link">
        Path tracing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_cli/" class="md-nav__link">
        Command-line utilities
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_sceneio/" class="md-nav__link">
        Image, shape and scene serialization
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_modelio/" class="md-nav__link">
        Model serialization
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_parallel/" class="md-nav__link">
        Concurrency utilities
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_json/" class="md-nav__link">
        Json and serialization utilities
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#scene-representation" class="md-nav__link">
    Scene representation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cameras" class="md-nav__link">
    Cameras
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#instances" class="md-nav__link">
    Instances
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environments" class="md-nav__link">
    Environments
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shapes" class="md-nav__link">
    Shapes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#materials" class="md-nav__link">
    Materials
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#textures" class="md-nav__link">
    Textures
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#subdivs" class="md-nav__link">
    Subdivs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-scenes" class="md-nav__link">
    Example scenes
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="yoctoscene-scene-representation">Yocto/Scene: Scene representation</h1>
<p>Yocto/Scene define a simple scene representation, and related utilities,
used in the Yocto/GL path tracer and for scene IO.
Yocto/Scene is implemented in <code>yocto_scene.h</code> and <code>yocto_scene.cpp</code>.</p>
<h2 id="scene-representation">Scene representation</h2>
<p>Scenes are stored in <code>scene_data</code> structs and are comprised of arrays of
cameras, instances, shapes, materials, textures and environments.
The various objects are stored as values in arrays named like the object type.
Animation is not currently supported.
The scene representation is geared toward modeling physically-based environments.
In Yocto/Scene, lights are not explicitly defined, but implicitly comprised of
instances with emissive materials and environment maps.
All scenes and objects properties are accessible directly.</p>
<p>All scenes objects may have names that are used in IO. If names are defined,
that have to be unique. If not, names are automatically generated. Names are
stored separately from objects, for performance reasons. So for each object
array, Yocto/Scene stores a corresponding names array. For examples,
cameras as stored as <code>cameras</code> and their names are stored as <code>camera_names</code>.</p>
<p>Cameras, instances and environments have coordinate frames to define the local
to world transformation. Frames are presented as affine 3x4 matrices and are
intended to be rigid transforms, although most scene processing support frames
with scaling.</p>
<p>Objects are added to the scene by directly adding elements to the corresponding
arrays. References to elements are expressed as indices to the
corresponding arrays. For each element type, properties can be set directly.
Also, all scene objects are values, so you can work freely with them without
concerning yourself with memory management. The mantra we followed here is
that "if you know how to use <code>std::vector</code>, you know how to use scenes".</p>
<p>Here is an sketch of how to create a shape instance in a scene.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">scene</span> <span class="o">=</span> <span class="n">scene_data</span><span class="p">{};</span>          <span class="c1">// create a scene</span>
<span class="k">auto</span> <span class="n">shape</span> <span class="o">=</span> <span class="n">shape_data</span><span class="p">{};</span>          <span class="c1">// create a shape and add it</span>
<span class="n">set_shape_properties</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="p">...);</span>
<span class="n">scene</span><span class="p">.</span><span class="n">shapes</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">shape</span><span class="p">);</span>
<span class="n">scene</span><span class="p">.</span><span class="n">materials</span><span class="p">.</span><span class="n">push_back</span><span class="p">({});</span>      <span class="c1">// create a black material directly</span>
<span class="k">auto</span> <span class="n">instance</span> <span class="o">=</span> <span class="n">instance_data</span><span class="p">{};</span>    <span class="c1">// create an instance of last added shape</span>
<span class="n">instance</span><span class="p">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">scene</span><span class="p">.</span><span class="n">shapes</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="mi">-1</span><span class="p">;</span>
<span class="n">instance</span><span class="p">.</span><span class="n">material</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">scene</span><span class="p">.</span><span class="n">materials</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="mi">-1</span><span class="p">;</span>
</code></pre></div>
<p>Yocto/Scene defines several function to evaluate scene properties.
Use <code>compute_bounds(scene)</code> to compute the scene bounding boxes,<br />
<code>scene_stats(scene)</code> to get scene stats and
<code>scene_validation(scene)</code> to validate scene objects.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">scene</span> <span class="o">=</span> <span class="n">scene_scene</span><span class="p">{...};</span>              <span class="c1">// create a complete scene</span>
<span class="k">auto</span> <span class="n">bbox</span> <span class="o">=</span> <span class="n">compute_bounds</span><span class="p">(</span><span class="n">scene</span><span class="p">);</span>          <span class="c1">// get bounds</span>
<span class="k">auto</span> <span class="n">stats</span> <span class="o">=</span> <span class="n">scene_stats</span><span class="p">(</span><span class="n">scene</span><span class="p">);</span>            <span class="c1">// get stats</span>
<span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">stat</span> <span class="p">:</span> <span class="n">stats</span><span class="p">)</span> <span class="n">print_info</span><span class="p">(</span><span class="n">stat</span><span class="p">);</span>    <span class="c1">// print stats</span>
<span class="k">auto</span> <span class="n">errors</span> <span class="o">=</span> <span class="n">validate_stats</span><span class="p">(</span><span class="n">scene</span><span class="p">);</span>        <span class="c1">// get validation errors</span>
<span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">error</span> <span class="p">:</span> <span class="n">errors</span><span class="p">)</span> <span class="n">print_error</span><span class="p">(</span><span class="n">error</span><span class="p">);</span><span class="c1">// print error</span>
</code></pre></div>
<h2 id="cameras">Cameras</h2>
<p>Cameras, represented by <code>camera_data</code>, are based on a simple lens model.
Cameras coordinate systems are defined by their frame.
Cameras projections are described in photographic terms. In particular,
we specify film size (35mm by default), film aspect ration,
the lens' focal length, the focus distance and the lens aperture.
All values are in meters. We support both perspective and orthographic cameras,
but prefer the former.</p>
<p>Common aspect ratios used in video and still photography are
3:2 on 35 mm (0.036 x 0.024),
16:9 on 35 mm (0.036 x 0.02025 or 0.04267 x 0.024),
2.35:1 on 35 mm (0.036 x 0.01532 or 0.05640 x 0.024),
2.39:1 on 35 mm (0.036 x 0.01506 or 0.05736 x 0.024),
2.40:1 on 35 mm (0.036 x 0.015 or 0.05760 x 0.024).
To compute good apertures, one can use the F-stop number from photography
and set the aperture to focal length over f-stop.</p>
<p>To create cameras, you should set the camera frame, the camera view,
via lens, aspect and film, and optionally the camera aperture and focus.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">camera</span> <span class="o">=</span> <span class="n">camera_data</span><span class="p">{};</span>     <span class="c1">// create a camera</span>
<span class="n">camera</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">identity3x4f</span><span class="p">;</span>     <span class="c1">// set frame to identity</span>
<span class="n">camera</span><span class="p">.</span><span class="n">lens</span> <span class="o">=</span> <span class="mf">0.050</span><span class="p">;</span>             <span class="c1">// set as 50mm lens</span>
<span class="n">camera</span><span class="p">.</span><span class="n">aspect</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">;</span>             <span class="c1">// set 3:2 aspect ratio</span>
<span class="n">camera</span><span class="p">.</span><span class="n">film</span> <span class="o">=</span> <span class="mf">0.036</span><span class="p">;</span>             <span class="c1">// set the film as 35mm</span>
<span class="n">camera</span><span class="p">.</span><span class="n">aperture</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">;</span>          <span class="c1">// set 10mm aperture</span>
<span class="n">camera</span><span class="p">.</span><span class="n">focus</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>               <span class="c1">// set the focus at 10m</span>
</code></pre></div>
<p>Use <code>get_camera(scene, name)</code> to get a camera by name or the default camera
is the name is not given. Use <code>eval_camera(camera, image_uv, lens_uv)</code>
to get a camera ray from the normalized image coordinates <code>image_uv</code> and
lens coordinates <code>lens_uv</code>.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">scene</span> <span class="o">=</span> <span class="n">scene_data</span><span class="p">{...};</span>                  <span class="c1">// create a complete scene</span>
<span class="k">auto</span><span class="o">&amp;</span> <span class="n">camera</span> <span class="o">=</span> <span class="n">get_camera</span><span class="p">(</span><span class="n">scene</span><span class="p">);</span>              <span class="c1">// get default camera</span>
<span class="k">auto</span> <span class="n">ray</span> <span class="o">=</span> <span class="n">eval_camera</span><span class="p">(</span><span class="n">camera</span><span class="p">,{</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">},{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">});</span><span class="c1">// get ray though image center</span>
</code></pre></div>
<h2 id="instances">Instances</h2>
<p>Instances, represented as <code>instance_data</code>, place shapes in the scene by
defining their coordinate frame, a shape index and a material index.
Through the use of instancing, Yocto/Scene scales well to large environments
without introducing more complex mechanisms.</p>
<p>For instances, you should set the instance frame, shape and material.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">instance</span> <span class="o">=</span> <span class="n">instance_data</span><span class="p">{};</span>     <span class="c1">// create an instance</span>
<span class="n">instance</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">identity3x4f</span><span class="p">;</span>       <span class="c1">// set frame to identity</span>
<span class="n">instance</span><span class="p">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">shape_index</span><span class="p">;</span>        <span class="c1">// set shape index</span>
<span class="n">instance</span><span class="p">.</span><span class="n">material</span> <span class="o">=</span> <span class="n">material_index</span><span class="p">;</span>  <span class="c1">// set material index</span>
</code></pre></div>
<p>Several functions are defined to evaluate the geometric and material
properties of points on shapes and instances, indicated by the shape element id
and, when needed, the shape element barycentric coordinates. The difference
between the shape and instance methods is that the former returns quantities
in object space, while the latter in world space.
Use <code>eval_position(...)</code> to evaluate the point position,
<code>eval_normal(...)</code> to evaluate the interpolate point normal,
<code>eval_texcoord(...)</code> to evaluate the point texture coordinates,
<code>eval_element_normal(...)</code> to evaluate the point geometric normal, and
<code>eval_color(...)</code> to evaluate the interpolate point color.
Use <code>eval_material(...)</code> as a convenience function to evaluate material
properties of instance points.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">eid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="k">auto</span> <span class="n">euv</span> <span class="o">=</span> <span class="n">vec3f</span><span class="p">{</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">};</span>       <span class="c1">// element id and uvs</span>
<span class="k">auto</span> <span class="n">pos</span>  <span class="o">=</span> <span class="n">eval_position</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">eid</span><span class="p">,</span> <span class="n">euv</span><span class="p">);</span> <span class="c1">// eval point position</span>
<span class="k">auto</span> <span class="n">norm</span> <span class="o">=</span> <span class="n">eval_normal</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">eid</span><span class="p">,</span> <span class="n">euv</span><span class="p">);</span>   <span class="c1">// eval point normal</span>
<span class="k">auto</span> <span class="n">st</span>   <span class="o">=</span> <span class="n">eval_texcoord</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">eid</span><span class="p">,</span> <span class="n">euv</span><span class="p">);</span> <span class="c1">// eval point texture coords</span>
<span class="k">auto</span> <span class="n">col</span>  <span class="o">=</span> <span class="n">eval_color</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">eid</span><span class="p">,</span> <span class="n">euv</span><span class="p">);</span>    <span class="c1">// eval point color</span>
<span class="k">auto</span> <span class="n">gn</span>   <span class="o">=</span> <span class="n">eval_element_normal</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">eid</span><span class="p">,</span> <span class="n">euv</span><span class="p">);</span> <span class="c1">// eval geometric normal</span>
<span class="k">auto</span> <span class="n">mat</span>  <span class="o">=</span> <span class="n">eval_material</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">eid</span><span class="p">,</span> <span class="n">euv</span><span class="p">);</span> <span class="c1">// eval point material</span>
</code></pre></div>
<h2 id="environments">Environments</h2>
<p>Environments, represented as <code>environment_data</code>, store the background
illumination as a scene. Environments have a frame, to rotate illumination,
an emission term and an optional emission texture.
The emission texture is an HDR environment map stored in a LatLon
parametrization.</p>
<p>For environments, set the frame, emission and optionally the emission texture.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span><span class="o">&amp;</span> <span class="n">environment</span> <span class="o">=</span> <span class="n">environment_data</span><span class="p">{};</span>  <span class="c1">// create an environment</span>
<span class="n">environment</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">identity3x4f</span><span class="p">;</span>         <span class="c1">// set identity transform</span>
<span class="n">environment</span><span class="p">.</span><span class="n">emission</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">};</span>           <span class="c1">// set emission scale</span>
<span class="n">environment</span><span class="p">.</span><span class="n">emission_tex</span> <span class="o">=</span> <span class="n">texture_index</span><span class="p">;</span> <span class="c1">// add emission texture</span>
</code></pre></div>
<p>Use <code>eval_environment(environment, direction)</code> to evaluate an environment
map emission along a specific direction <code>direction</code>. Use
<code>eval_environment(scene, direction)</code> to accumulate the lighting for all
environment maps.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">scene</span> <span class="o">=</span> <span class="k">new</span> <span class="n">trace_scene</span><span class="p">{...};</span>               <span class="c1">// create a complete scene</span>
<span class="k">auto</span> <span class="n">enva</span> <span class="o">=</span> <span class="n">eval_environment</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">dir</span><span class="p">);</span>        <span class="c1">// eval all environments</span>
<span class="k">auto</span> <span class="n">environment</span> <span class="o">=</span> <span class="n">scene</span><span class="p">.</span><span class="n">environments</span><span class="p">.</span><span class="n">front</span><span class="p">();</span>  <span class="c1">// get first environment</span>
<span class="k">auto</span> <span class="n">envi</span> <span class="o">=</span> <span class="n">eval_environment</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span> <span class="n">dir</span><span class="p">);</span>  <span class="c1">// eval environment</span>
</code></pre></div>
<h2 id="shapes">Shapes</h2>
<p>Shapes, represented by <code>shape_data</code>, are indexed meshes of elements.
Shapes are defined in <a href="../yocto_shape/">Yocto/Shape</a>, and briefly described 
here for convenience. Shapes can contain only one type of element, either
points, lines, triangles or quads. Shape elements are parametrized as in
<a href="../yocto_geometry/">Yocto/Geometry</a>.
Vertex properties are defined as separate arrays and include
positions, normals, texture coords, colors, radius and tangent spaces.
Additionally, Yocto/Scene supports face-varying primitives, as <code>fvshape_data</code>,
where each vertex data has its own topology.</p>
<p>Shapes also work as a standalone mesh representation throughout the
library and can be used even without a scene.</p>
<p>For shapes, you should set the shape elements, i.e. point, limes, triangles
or quads, and the vertex properties, i.e. positions, normals, texture
coordinates, colors and radia. Shapes support only one element type.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">shape</span> <span class="o">=</span> <span class="n">shape_data</span><span class="p">{};</span>             <span class="c1">// create a shape</span>
<span class="n">shape</span><span class="p">.</span><span class="n">triangles</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec3i</span><span class="o">&gt;</span><span class="p">{...};</span>  <span class="c1">// set triangle indices</span>
<span class="n">shape</span><span class="p">.</span><span class="n">positions</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec3f</span><span class="o">&gt;</span><span class="p">{...};</span>  <span class="c1">// set positions</span>
<span class="n">shape</span><span class="p">.</span><span class="n">normals</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec3f</span><span class="o">&gt;</span><span class="p">{...};</span>    <span class="c1">// set normals</span>
<span class="n">shape</span><span class="p">.</span><span class="n">texcoords</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec2f</span><span class="o">&gt;</span><span class="p">{...};</span>  <span class="c1">// set texture coordinates</span>
</code></pre></div>
<p>Several functions are defined to evaluate the geometric properties of points
of shapes, indicated by the shape element id and, when needed, the shape element
barycentric coordinates.
Use <code>eval_position(...)</code> to evaluate the point position,
<code>eval_normal(...)</code> to evaluate the interpolate point normal,
<code>eval_texcoord(...)</code> to evaluate the point texture coordinates,
<code>eval_element_normal(...)</code> to evaluate the point geometric normal, and
<code>eval_color(...)</code> to evaluate the interpolate point color.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">eid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="k">auto</span> <span class="n">euv</span> <span class="o">=</span> <span class="n">vec3f</span><span class="p">{</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">};</span>    <span class="c1">// element id and uvs</span>
<span class="k">auto</span> <span class="n">pos</span>  <span class="o">=</span> <span class="n">eval_position</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">eid</span><span class="p">,</span> <span class="n">euv</span><span class="p">);</span> <span class="c1">// eval point position</span>
<span class="k">auto</span> <span class="n">norm</span> <span class="o">=</span> <span class="n">eval_normal</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">eid</span><span class="p">,</span> <span class="n">euv</span><span class="p">);</span>   <span class="c1">// eval point normal</span>
<span class="k">auto</span> <span class="n">st</span>   <span class="o">=</span> <span class="n">eval_texcoord</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">eid</span><span class="p">,</span> <span class="n">euv</span><span class="p">);</span> <span class="c1">// eval point texture coords</span>
<span class="k">auto</span> <span class="n">col</span>  <span class="o">=</span> <span class="n">eval_color</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">eid</span><span class="p">,</span> <span class="n">euv</span><span class="p">);</span>    <span class="c1">// eval point color</span>
<span class="k">auto</span> <span class="n">gn</span>   <span class="o">=</span> <span class="n">eval_element_normal</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">eid</span><span class="p">,</span> <span class="n">euv</span><span class="p">);</span> <span class="c1">// eval geometric normal</span>
</code></pre></div>
<p>Shape support random sampling with a uniform distribution using
<code>sample_shape(...)</code> and <code>sample_shape_cdf(shape)</code>. Sampling works for lines and
triangles in all cases, while for quad it requires that the elements
are rectangular.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">cdf</span> <span class="o">=</span> <span class="n">sample_shape_cdfd</span><span class="p">(</span><span class="n">shape</span><span class="p">);</span>         <span class="c1">// compute the shape CDF</span>
<span class="k">auto</span> <span class="n">points</span> <span class="o">=</span> <span class="n">sample_shape</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">cdf</span><span class="p">,</span> <span class="n">num</span><span class="p">);</span> <span class="c1">// sample many points</span>
<span class="k">auto</span> <span class="n">point</span> <span class="o">=</span> <span class="n">sample_shape</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">cdf</span><span class="p">,</span>        <span class="c1">// sample a single point</span>
  <span class="n">rand1f</span><span class="p">(</span><span class="n">rng</span><span class="p">),</span> <span class="n">rand2f</span><span class="p">(</span><span class="n">rng</span><span class="p">));</span>
</code></pre></div>
<p>For shapes, we also support the computation of smooth vertex normals with
<code>compute_normals(shape)</code> and converting to and from face-varying representations
with <code>shape_to_fvshape(shape)</code> and <code>fvshape_to_shape(fvshape)</code>.</p>
<h2 id="materials">Materials</h2>
<p>Materials, represented as <code>material_data</code>, are defined by a material type
and a few parameters, common to all materials. In particular, we support the
following materials:</p>
<ul>
<li><code>matte</code>, for materials like concrete or stucco, implemented as a lambertian bsdf;</li>
<li><code>glossy</code>, for materials like plastic or painted wood, implemented as the sum
  of a lambertian and a microfacet dielectric lobe;</li>
<li><code>reflective</code>, for materials like metals, implemented as either a delta or
  microfacet brdf lobe;</li>
<li><code>transparent</code>, for materials for thin glass, implemented as a delta or
  microfacet transmission bsdf;</li>
<li><code>refractive</code>, for materials for glass or water, implemented as a delta or
  microfacet refraction bsdf; also support homogenous volume scattering;</li>
<li><code>subsurface</code>, for materials for skin, implemented as a microfacet refraction
  bsdf with homogenous volume scattering - for no this is like <code>refractive</code>;</li>
<li><code>volumetric</code>, for materials like homogeneous smoke or fog, implemented as the lack
  of a surface interface but with volumetric scattering.</li>
<li><code>gltfpbr</code>, for materials that range from glossy to metallic, implemented as
  the sum of a lambertian and a microfacet dielectric lobe;
  this is a compatibility material for loading and saving Khronos glTF data.</li>
</ul>
<p>All materials can specify a diffuse surface emission <code>emission</code> with HDR values
that represent emitted radiance.</p>
<p>Surface scattering is controlled by specifying the main surface color <code>color</code>,
that represent the surface albedo, the surface roughness <code>roughness</code> and
the index of refraction <code>ior</code>. The physical meaning of each parameter depends
on the material type. By default surfaces are fully opaque, but
can defined a <code>opacity</code> parameter and texture to define the surface coverage.</p>
<p>Materials like <code>refractive</code>, <code>subsurface</code> and <code>volumetric</code> may also specify
volumetric properties. In these cases, the <code>color</code> parameter controls the volume density,
while the <code>scattering</code> also define volumetric scattering properties by setting a
<code>transmission</code> parameter controls the homogenous volume scattering.</p>
<p>All parameters can modulated by a corresponding textures, if present.</p>
<p>For materials, we need to specify the material type and color at the minimum.
We can further control the appearance by changing surface roughness, index of
refraction and volumetric properties, when appropriate. Here are some examples.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">matte</span> <span class="o">=</span> <span class="n">material_data</span><span class="p">{};</span>            <span class="c1">// create a matte material</span>
<span class="n">matte</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">material_type</span><span class="o">::</span><span class="n">matte</span><span class="p">;</span>
<span class="n">matte</span><span class="p">.</span><span class="n">color</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">};</span>               <span class="c1">// with base color and</span>
<span class="n">matte</span><span class="p">.</span><span class="n">color_tex</span> <span class="o">=</span> <span class="n">texture_id</span><span class="p">;</span>            <span class="c1">// textured albedo</span>
<span class="k">auto</span> <span class="n">glossy</span> <span class="o">=</span>  <span class="n">material_data</span><span class="p">{};</span>          <span class="c1">// create a glossy material</span>
<span class="n">glossy</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">material_type</span><span class="o">::</span><span class="n">glossy</span><span class="p">;</span>
<span class="n">glossy</span><span class="p">.</span><span class="n">color</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">};</span>              <span class="c1">// with constant color</span>
<span class="n">glossyv</span><span class="p">.</span><span class="n">roughness</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>                 <span class="c1">// base roughness and a</span>
<span class="n">glossy</span><span class="p">.</span><span class="n">roughness_tex</span> <span class="o">=</span> <span class="n">texture_id</span><span class="p">;</span>       <span class="c1">// roughness texture</span>
<span class="k">auto</span> <span class="n">reflective</span> <span class="o">=</span>  <span class="n">material_data</span><span class="p">{};</span>      <span class="c1">// create a reflective material</span>
<span class="n">glossy</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">material_type</span><span class="o">::</span><span class="n">reflective</span>
<span class="n">reflective</span><span class="p">.</span><span class="n">color</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">1</span><span class="p">};</span>          <span class="c1">// constant color</span>
<span class="n">reflective</span><span class="p">.</span><span class="n">roughness</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>              <span class="c1">// constant roughness</span>
<span class="k">auto</span> <span class="n">tglass</span> <span class="o">=</span> <span class="n">material_data</span><span class="p">{};</span>           <span class="c1">// create a transparent material</span>
<span class="n">tglass</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">material_type</span><span class="o">::</span><span class="n">transparent</span><span class="p">;</span>
<span class="n">tglass</span><span class="p">.</span><span class="n">color</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">};</span>                  <span class="c1">// with constant color</span>
<span class="k">auto</span> <span class="n">glass</span> <span class="o">=</span> <span class="n">material_data</span><span class="p">{};</span>            <span class="c1">// create a refractive material</span>
<span class="n">glass</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">material_type</span><span class="o">::</span><span class="n">transparent</span><span class="p">;</span>
<span class="n">glass</span><span class="p">.</span><span class="n">color</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="mf">0.9</span><span class="p">};</span>               <span class="c1">// constant color</span>
<span class="k">auto</span> <span class="n">subsurf</span> <span class="o">=</span> <span class="n">material_data</span><span class="p">{};</span>          <span class="c1">// create a refractive material</span>
<span class="n">subsurf</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">material_type</span><span class="o">::</span><span class="n">subsurface</span><span class="p">;</span>
<span class="n">subsurf</span><span class="p">.</span><span class="n">color</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">};</span>                 <span class="c1">// that transmits all light</span>
<span class="n">subsurf</span><span class="p">.</span><span class="n">scattering</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">};</span>        <span class="c1">// and has volumetric scattering</span>
</code></pre></div>
<p>Lights are not explicit in Yocto/Scene but are specified by assigning emissive
materials.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">light</span> <span class="o">=</span> <span class="n">material_data</span><span class="p">{};</span>    <span class="c1">// create a material</span>
<span class="n">light</span><span class="p">.</span><span class="n">color</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">};</span>           <span class="c1">// that does not reflect light</span>
<span class="n">light</span><span class="p">.</span><span class="n">emission</span> <span class="o">=</span> <span class="p">{</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">};</span>     <span class="c1">// but emits it instead</span>
</code></pre></div>
<p>Use <code>eval_material(material, texcoord)</code> to evaluate material textures and
combine them with parameter values. The function returns a
<code>material_point</code> that has the same parameters of a material but no
textures defined.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">mat</span> <span class="o">=</span> <span class="n">eval_material</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span><span class="n">material</span><span class="p">,{</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">})</span> <span class="c1">// eval material</span>
</code></pre></div>
<h2 id="textures">Textures</h2>
<p>Textures, represented as <code>texture_data</code>, contains either 8-bit LDR or
32-bit float HDR images with four channels. Textures can be encoded in either
a linear color space or as sRGBs, depending on an internal flag. The use of
float versus byte is just a memory saving feature.</p>
<p>For textures, set the size, the color space, and <em>either</em> the hdr or ldr pixels.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">hdr_texture</span> <span class="o">=</span> <span class="n">texture_data</span><span class="p">{};</span>   <span class="c1">// create a texture</span>
<span class="n">hdr_texture</span><span class="p">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span>             <span class="c1">// set size</span>
<span class="n">hdr_texture</span><span class="p">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span>
<span class="n">hdr_texture</span><span class="p">.</span><span class="n">linear</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>           <span class="c1">// set color space and pixels for an HDR</span>
<span class="n">hdr_texture</span><span class="p">.</span><span class="n">pixelsf</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec4f</span><span class="o">&gt;</span><span class="p">{...};</span>
<span class="k">auto</span> <span class="n">ldr_texture</span> <span class="o">=</span> <span class="n">texture_data</span><span class="p">{};</span>   <span class="c1">// create a texture</span>
<span class="n">ldr_texture</span><span class="p">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span>             <span class="c1">// set size</span>
<span class="n">ldr_texture</span><span class="p">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span>
<span class="n">ldr_texture</span><span class="p">.</span><span class="n">linear</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>          <span class="c1">// set color space and pixels for an LDR</span>
<span class="n">ldr_texture</span><span class="p">.</span><span class="n">pixelsb</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec4b</span><span class="o">&gt;</span><span class="p">{...};</span>
</code></pre></div>
<p>Use <code>eval_texture(texture, uv)</code> to evaluate the texture at specific uvs.
Textures evaluation returns a color in linear color space, regardless of
the texture representation.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">col</span> <span class="o">=</span> <span class="n">eval_texture</span><span class="p">(</span><span class="n">texture</span><span class="p">,{</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">});</span>   <span class="c1">// eval texture</span>
</code></pre></div>
<h2 id="subdivs">Subdivs</h2>
<p>Subdivs, represented as <code>subdiv_data</code>, support tesselation and displacement
mapping. Subdivs are represented as facee-varying shapes.
Subdivs specify a level of subdivision and can be subdivide elements
either linearly or using Catmull-Clark subdivision. Subdivs also support
displacement by specifying both a displacement texture and a displacement amount.
Differently from most systems, in Yocto/Scene displacement is specified
in the shape and not the material. Subdivs only support tesselation to shapes,
but do not directly support additional evaluation of properties.
Subdivs specified to the shape index to which they are subdivided into.</p>
<p>In this case, set the quads for positions, normals and texture coordinates.
Also set the subdivision level, and whether to use Catmull-Clark or linear
subdivision. Finally, displacement can also be applied by setting a displacement
scale and texture.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">subdiv</span> <span class="o">=</span> <span class="n">scene_sundiv</span><span class="p">{};</span>             <span class="c1">// create a subdiv</span>
<span class="n">subdiv</span><span class="p">.</span><span class="n">quadspos</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec4i</span><span class="o">&gt;</span><span class="p">{...};</span>     <span class="c1">// set face-varying indices</span>
<span class="n">subdiv</span><span class="p">.</span><span class="n">quadstexcoord</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec4i</span><span class="o">&gt;</span><span class="p">{...};</span><span class="c1">// for positions and textures</span>
<span class="n">subdiv</span><span class="p">.</span><span class="n">positions</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec3f</span><span class="o">&gt;</span><span class="p">{...};</span>    <span class="c1">// set positions</span>
<span class="n">subdiv</span><span class="p">.</span><span class="n">texcoords</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vec2f</span><span class="o">&gt;</span><span class="p">{...};</span>    <span class="c1">// set texture coordinates</span>
<span class="n">subdiv</span><span class="p">.</span><span class="n">subdivisions</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>                  <span class="c1">// set subdivision level</span>
<span class="n">subdiv</span><span class="p">.</span><span class="n">catmullclark</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>               <span class="c1">// set Catmull-Clark subdivision</span>
<span class="n">subdiv</span><span class="p">.</span><span class="n">displacement</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>                  <span class="c1">// set displacement scale</span>
<span class="n">subdiv</span><span class="p">.</span><span class="n">displacement_tex</span> <span class="o">=</span> <span class="n">texture_id</span><span class="p">;</span>     <span class="c1">// and displacement map</span>
</code></pre></div>
<p>Most properties on subdivs cannot be directly evaluated, nor they are
supported directly in scene processing. Instead, subdivs are converted to
indexed shapes using <code>tesselate_subdiv(subdiv, shape)</code> for a specific subdiv,
or <code>tesselate_subdivs(scene)</code> for the whole scene.</p>
<div class="highlight"><pre><span></span><code><span class="n">tesselate_subdivs</span><span class="p">(</span><span class="n">scene</span><span class="p">);</span>     <span class="c1">// tesselate all subdivs in the scene</span>
</code></pre></div>
<h2 id="example-scenes">Example scenes</h2>
<p>Yocto/Scene has a function to create a simple Cornell Box scene for testing.
There are plans to increase support for more test scenes in the future.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">scene</span> <span class="o">=</span> <span class="n">make_cornellbox</span><span class="p">();</span>             <span class="c1">// make cornell box</span>
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../yocto_mesh/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Mesh processing
            </div>
          </div>
        </a>
      
      
        <a href="../yocto_bvh/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Ray-scene intersection
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2016 - 2020 Fabio Pellacini
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.fb4a9340.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.5cf3e710.min.js"></script>
      
    
  </body>
</html>