
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <meta name="author" content="Fabio Pellacini">
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.0.5">
    
    
      
        <title>Json and serialization utilities - Yocto/GL</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.77f3fd56.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.7fa14f5b.min.css">
        
          
          
          <meta name="theme-color" content="#2094f3">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue" data-md-color-accent="">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#yoctocommonio-common-io-functionality" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Yocto/GL" class="md-header__button md-logo" aria-label="Yocto/GL">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Yocto/GL
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Json and serialization utilities
            
          </span>
        </div>
      </div>
    </div>
    <div class="md-header__options">
      
    </div>
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/xelatihy/yocto-gl/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    xelatihy/yocto-gl
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Yocto/GL" class="md-nav__button md-logo" aria-label="Yocto/GL">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Yocto/GL
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/xelatihy/yocto-gl/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    xelatihy/yocto-gl
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../gallery/" class="md-nav__link">
        Gallery
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_math/" class="md-nav__link">
        Math types
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_color/" class="md-nav__link">
        Color operations
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_geometry/" class="md-nav__link">
        Geometry operations
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_sampling/" class="md-nav__link">
        Sampling routines
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_noise/" class="md-nav__link">
        Noise functions
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_shading/" class="md-nav__link">
        Shading routines
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_image/" class="md-nav__link">
        Image utilities
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_shape/" class="md-nav__link">
        Shape utilities
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_mesh/" class="md-nav__link">
        Mesh processing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_scene/" class="md-nav__link">
        Scene representation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_bvh/" class="md-nav__link">
        Ray-scene intersection
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_trace/" class="md-nav__link">
        Path tracing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_cli/" class="md-nav__link">
        Command-line utilities
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_imageio/" class="md-nav__link">
        Image serialization
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_shapeio/" class="md-nav__link">
        Shape serialization
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_sceneio/" class="md-nav__link">
        Scene serialization
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Json and serialization utilities
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Json and serialization utilities
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#errors-handling-in-io-functions" class="md-nav__link">
    Errors handling in IO functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#text-and-binary-serialization" class="md-nav__link">
    Text and binary serialization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#path-manipulation-utilities" class="md-nav__link">
    Path manipulation utilities
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#json-data-type" class="md-nav__link">
    Json data type
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#json-serialization" class="md-nav__link">
    Json serialization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ordered-map" class="md-nav__link">
    Ordered map
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_modelio/" class="md-nav__link">
        Model serialization
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../yocto_parallel/" class="md-nav__link">
        Concurrency utilities
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#errors-handling-in-io-functions" class="md-nav__link">
    Errors handling in IO functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#text-and-binary-serialization" class="md-nav__link">
    Text and binary serialization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#path-manipulation-utilities" class="md-nav__link">
    Path manipulation utilities
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#json-data-type" class="md-nav__link">
    Json data type
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#json-serialization" class="md-nav__link">
    Json serialization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ordered-map" class="md-nav__link">
    Ordered map
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="yoctocommonio-common-io-functionality">Yocto/CommonIO: Common IO functionality</h1>
<p>Yocto/CommonIO is a collection of utilities used in writing IO functionality,
including file IO, Json IO, and path manipulation.
Yocto/CommonIO is implemented in <code>yocto_commonio.h</code> and <code>yocto_commonio.cpp</code>, 
and depends on <code>json.hpp</code> for Json serialization and number printing, and
<code>fast_float.h</code> for number parsing.</p>
<h2 id="errors-handling-in-io-functions">Errors handling in IO functions</h2>
<p>IO functions in Yocto/GL have a dual interface to support their use with and 
without exceptions. IO functions with exception are written as 
<code>load_&lt;type&gt;(filename, data, &lt;options&gt;)</code> and 
<code>save_&lt;type&gt;(filename, data, &lt;options&gt;)</code> where <code>&lt;type&gt;</code> is the data type 
read or written, and <code>&lt;options&gt;</code> is an optional list of IO options. 
A convenience shortcut is provided for all loading functions that returns the 
data directly, written as <code>data = load_&lt;type&gt;(filename, &lt;options&gt;)</code>.
Upon errors, an <code>io_error</code> is thrown from all IO functions.
This makes the error-handling code more uniform across the library. 
<code>io_error</code> has fields for <code>filename</code> and <code>message</code> that can retrieved directly, 
and a message for users that can be retrieved with the <code>.what()</code> method.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">text</span> <span class="o">=</span> <span class="n">string</span><span class="p">{};</span>
<span class="k">try</span> <span class="p">{</span>
  <span class="n">load_text</span><span class="p">(</span><span class="s">&quot;input_file.txt&quot;</span><span class="p">,</span>  <span class="n">text</span><span class="p">);</span>   <span class="c1">// load text</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">load_text</span><span class="p">(</span><span class="s">&quot;input_file.txt&quot;</span><span class="p">);</span>   <span class="c1">// alternative load</span>
  <span class="n">save_text</span><span class="p">(</span><span class="s">&quot;output_file.txt&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">);</span>   <span class="c1">// save text</span>
<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="k">const</span> <span class="n">io_error</span><span class="o">&amp;</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">print_info</span><span class="p">(</span><span class="n">error</span><span class="p">.</span><span class="n">what</span><span class="p">());</span> <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>    <span class="c1">// handle error</span>
<span class="p">}</span>
</code></pre></div>
<p>IO functions without exceptions are written as
<code>load_&lt;type&gt;(filename, data, error, &lt;options&gt;)</code> and 
<code>save_&lt;type&gt;(filename, data, error, &lt;options&gt;)</code> where <code>error</code> is a string 
that contains a message if an error occurred. These functions return a boolean 
flag that indicates whether the operation succeeded.  </p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">text</span> <span class="o">=</span> <span class="n">string</span><span class="p">{};</span>
<span class="k">auto</span> <span class="n">error</span> <span class="o">=</span> <span class="n">string</span><span class="p">{};</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">load_text</span><span class="p">(</span><span class="s">&quot;input_file.txt&quot;</span><span class="p">,</span>  <span class="n">text</span><span class="p">))</span>      <span class="c1">// load text</span>
  <span class="n">print_info</span><span class="p">(</span><span class="n">error</span><span class="p">);</span> <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>                <span class="c1">// handle error</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">save_text</span><span class="p">(</span><span class="s">&quot;output_file.txt&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">))</span>      <span class="c1">// save text</span>
  <span class="n">print_info</span><span class="p">(</span><span class="n">error</span><span class="p">);</span> <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>                <span class="c1">// handle error</span>
</code></pre></div>
<h2 id="text-and-binary-serialization">Text and binary serialization</h2>
<p>Yocto/CommonIO supports reading and writing whole files of either binary
data or text. Use <code>load_text(filename, text)</code> or <code>text = load_text(filename)</code> 
to load text, and <code>save_text(filename, text)</code> to save it.
Use <code>load_binary(filename, data)</code> or <code>data = load_binary(filename)</code> 
to load text, and <code>save_binary(filename, data)</code> to save it. 
Text is stored as a string and binary data is stored as an array of bytes.
Use without exception is supported as described above.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">text</span> <span class="o">=</span> <span class="n">string</span><span class="p">{};</span>
<span class="n">load_text</span><span class="p">(</span><span class="s">&quot;input_file.txt&quot;</span><span class="p">,</span>  <span class="n">text</span><span class="p">);</span>          <span class="c1">// load text</span>
<span class="n">save_text</span><span class="p">(</span><span class="s">&quot;output_file.txt&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">);</span>          <span class="c1">// save text</span>
<span class="k">auto</span> <span class="n">text1</span> <span class="o">=</span> <span class="n">load_text</span><span class="p">(</span><span class="s">&quot;input_file.txt&quot;</span><span class="p">);</span>    <span class="c1">// alternative load</span>
<span class="k">auto</span> <span class="n">data</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">byte</span><span class="o">&gt;</span><span class="p">{};</span>
<span class="n">load_binary</span><span class="p">(</span><span class="s">&quot;input_file.bin&quot;</span><span class="p">,</span>  <span class="n">data</span><span class="p">);</span>        <span class="c1">// load data</span>
<span class="n">save_binary</span><span class="p">(</span><span class="s">&quot;output_file.bin&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>        <span class="c1">// save data</span>
<span class="k">auto</span> <span class="n">data1</span> <span class="o">=</span> <span class="n">load_binary</span><span class="p">(</span><span class="s">&quot;input_file.bin&quot;</span><span class="p">);</span>  <span class="c1">// alternative load</span>
</code></pre></div>
<h2 id="path-manipulation-utilities">Path manipulation utilities</h2>
<p>Yocto/CommonIO contains several helper function to manipulate paths. Paths
are encoded in UTF8 across the library and these functions make it easier to
handle UTF8-encoded paths across operating systems, by wrapping 
<code>std::filesystem</code> with a string interface.</p>
<p>Use <code>path_dirname(filename)</code>, <code>path_extension(filename)</code>,<br />
<code>path_filename(filename)</code>, <code>path_basename(fillename)</code>
to extract the directory, extension, filename and basename from a path.
Use <code>path_join(patha,pathb)</code> to joins paths and
<code>replace_extension(filename,ext)</code> to replace a path extension.
Use <code>path_exists(filename)</code> to check if a path exists and
<code>path_isdir(filename)</code> and <code>path_isfile(filename)</code> to check whether
it is a directory ot file respectively.
Use <code>list_directory(dirname)</code> to list directory contents, 
<code>make_directory(dirname)</code> to create a directory, and
<code>path_current()</code> to get the current directory.</p>
<h2 id="json-data-type">Json data type</h2>
<p>Throughout the library, JSON data is used extensively as a simple and flexible
IO format. Most JSON libraries we reviewed use header-only formulation that
slow down compile time significantly. For this reason, we provide a simple
JSON data type modeled after <code>nlohmann::json</code>. Here we review quickly its
functionality, for those familiar with the JSON format.</p>
<p>We model JSON values with the <code>json_value</code> type. Most functionality in this
type mimic the C++ <code>vector</code> and <code>map</code> functions. In fact, if you know how 
to use those type and you know how to handle JSON data, then it should be 
easy to use <code>json_value</code>. Json</p>
<p>Json values are unions of either null, strings, booleans, numbers, arrays 
of Json values and dictionaries of string to Json values. To avoid loosing
precision, we store numbers with 64 bits per value and as either signed
integers, unsigned integers, or floating point. Json arrays are stored as
<code>vector&lt;json_value&gt;</code>, while Json dictionaries are stored as ordered maps,
which are roughly equivalent to <code>vector&lt;pair&lt;string, json_value&gt;&gt;</code>. 
The choice off dictionary storage handle well small dictionaries, which is 
mostly the case in Json.</p>
<p>The type of a <code>json_value</code> is queried by the <code>json.type()</code> method that returns 
a <code>json_type</code> value. More conveniently, you can query thee type with 
<code>json.is_null()</code>, <code>json.is_integer()</code>, <code>json.is_number()</code>, <code>json.is_boolean()</code>, 
<code>json.is_string()</code>,<code>json.is_array()</code>, and <code>json.is_object()</code>. 
<code>json.is_integer()</code> checks if a number is signed or unsigned integer, 
while <code>json.is_number()</code> returns true for any number type.</p>
<p>You can convert values to a <code>json_value</code> by either constructing it,
assigning to it and calling the <code>json.set(value)</code> method with values of all 
builtin types, arrays of builtin types and enums, if they define the trait 
<code>json_enum_trait</code>.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">json</span> <span class="o">=</span> <span class="n">json_value</span><span class="p">{</span><span class="mi">5</span><span class="p">};</span>        <span class="c1">// construct a value of type integer</span>
<span class="n">json</span> <span class="o">=</span> <span class="s">&quot;text&quot;</span><span class="p">;</span>                    <span class="c1">// converts to a value of type string</span>
<span class="n">json</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">{...});</span>     <span class="c1">// converts to a value of type array</span>
</code></pre></div>
<p>You can convert a <code>json_value</code> to values by either casting to the type of the
value or calling the <code>json.get(value)</code> and <code>value = json.get&lt;type&gt;()</code> methods. 
A <code>json_error</code> is thrown if the conversion cannot be done.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">json</span> <span class="o">=</span> <span class="n">json_value</span><span class="p">{</span><span class="s">&quot;hello&quot;</span><span class="p">};</span>  <span class="c1">// construct a json_value</span>
<span class="k">auto</span> <span class="n">text</span> <span class="o">=</span> <span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="n">json</span><span class="p">;</span>         <span class="c1">// convert to string</span>
<span class="n">json</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>                   <span class="c1">// convert to string</span>
</code></pre></div>
<p>Besides conversions, Json arrays and dictionaries can be manipulated directly.
Json arrays are constructed by assigning a <code>json_array</code> to a <code>json_value</code>, 
either constructed directly or via the <code>json_value::array()</code> and 
<code>json_value::array(size)</code>. Array sizes are queries via the <code>json.empty()</code> and 
<code>json.size()</code> methods. Arrays can be resized with <code>json.resize(size)</code>, or by
appending values at the array end with <code>json.push_back(value)</code> and 
<code>json.emplace_back(args...)</code>. Array items are accessed by index with the 
<code>[index]</code> operator and the <code>json.at(index)</code> method. Arrays can be iterated
by using the <code>json.begin()</code> and <code>json.end()</code> methods.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">json</span> <span class="o">=</span> <span class="n">json_value</span><span class="o">::</span><span class="n">array</span><span class="p">();</span>  <span class="c1">// construct a value containing an array</span>
<span class="n">json</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">json_value</span><span class="p">{...});</span>  <span class="c1">// append a value</span>
<span class="n">json</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>                <span class="c1">// append a value converted from an int</span>
<span class="k">auto</span> <span class="n">size</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>          <span class="c1">// get size</span>
<span class="k">auto</span> <span class="n">converted</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">json</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span> <span class="c1">// access value by index</span>
<span class="k">for</span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span> <span class="nl">item</span> <span class="p">:</span> <span class="n">json</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>    <span class="c1">// iterate over the array</span>
</code></pre></div>
<p>Json dictionaries are constructed by assigning a <code>json_object</code> to a <code>json_value</code>, 
either constructed directly or via the <code>json_value::object()</code>. Object sizes 
are queries via the <code>json.empty()</code> and <code>json.size()</code> methods. Values are
inserted in dictionaries by using the <code>[key]</code> operator, or using the 
<code>insert_back(key, value)</code> method for a faster insertion that does not check
for duplicate keys. Object items are accessed by key with the <code>[key]</code> operator 
and the <code>json.at(key)</code> method. The existence of a key is checked with the 
<code>json.contains(key)</code> method. Json dictionaries are iterated with the 
<code>json.items().begin()</code> and <code>json.items().end()</code>.
Missing keys are so common in Json that Json dictionaries support the 
<code>json.try_get(key, value)</code> that assigns to the value only if the key is present,
and <code>json.get_or(key, default)</code> that returns the value if the key is present or
the default value specified.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">json</span> <span class="o">=</span> <span class="n">json_value</span><span class="o">::</span><span class="n">object</span><span class="p">();</span>     <span class="c1">// construct a value containing a dict.</span>
<span class="n">json</span><span class="p">[</span><span class="s">&quot;key&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json_value</span><span class="p">{...};</span>        <span class="c1">// insert a value</span>
<span class="n">json</span><span class="p">[</span><span class="s">&quot;key&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>                      <span class="c1">// insert a value converted from an int</span>
<span class="k">auto</span> <span class="n">size</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>              <span class="c1">// get size</span>
<span class="k">auto</span> <span class="n">converted</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">json</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="s">&quot;key&quot;</span><span class="p">);</span> <span class="c1">// access value by key</span>
<span class="k">for</span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span> <span class="p">[</span><span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">]</span> <span class="o">:</span> <span class="n">json</span><span class="p">.</span><span class="n">items</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>  <span class="c1">// iterate over the dictionary</span>
<span class="k">auto</span> <span class="n">value</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">get_or</span><span class="p">(</span><span class="s">&quot;key&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>   <span class="c1">// get value or default</span>
<span class="n">json</span><span class="p">.</span><span class="n">try_get</span><span class="p">(</span><span class="s">&quot;key&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>           <span class="c1">// get value if present</span>
</code></pre></div>
<h2 id="json-serialization">Json serialization</h2>
<p>Use <code>load_json(filename, json)</code> or <code>json = load_json(filename)</code> to load json 
data from a file, and <code>save_json(filename, json)</code> to save json data to a file. 
Upon errors, an <code>io_error</code> is thrown from all IO functions.
See <a href="./">Yocto/CommonIO</a> for discussion on error handling 
and use without exceptions.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">json</span> <span class="o">=</span> <span class="n">json_value</span><span class="p">{};</span>
<span class="n">load_json</span><span class="p">(</span><span class="s">&quot;input_file.json&quot;</span><span class="p">,</span>  <span class="n">json</span><span class="p">);</span>       <span class="c1">// load json</span>
<span class="n">save_json</span><span class="p">(</span><span class="s">&quot;output_file.json&quot;</span><span class="p">,</span> <span class="n">json</span><span class="p">);</span>       <span class="c1">// save json</span>
<span class="k">auto</span> <span class="n">json1</span> <span class="o">=</span> <span class="n">load_json</span><span class="p">(</span><span class="s">&quot;input_file.txt&quot;</span><span class="p">);</span>  <span class="c1">// alternative load</span>
</code></pre></div>
<p>Use <code>parse_json(text, json)</code>  or <code>json = parse_json(text)</code> to parse json data 
from a string, and <code>format_json(text, json)</code> or <code>text = format_json(json)</code> to 
write json data to a string.
Use without exception is supported as described above.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span> <span class="n">input_string</span>  <span class="o">=</span> <span class="n">string</span><span class="p">{...};</span>
<span class="k">auto</span> <span class="n">json</span> <span class="o">=</span> <span class="n">json_value</span><span class="p">{};</span>
<span class="n">parse_json</span><span class="p">(</span><span class="n">input_string</span><span class="p">,</span> <span class="n">json</span><span class="p">);</span>            <span class="c1">// parse json</span>
<span class="k">auto</span> <span class="n">output_string</span> <span class="o">=</span> <span class="n">string</span><span class="p">{};</span>
<span class="n">format_json</span><span class="p">(</span><span class="n">output_string</span><span class="p">,</span> <span class="n">json</span><span class="p">);</span>          <span class="c1">// format json</span>
<span class="k">auto</span> <span class="n">json1</span> <span class="o">=</span> <span class="n">parse_json</span><span class="p">(</span><span class="n">input_string</span><span class="p">);</span>     <span class="c1">// alternative parse</span>
<span class="k">auto</span> <span class="n">output_string1</span> <span class="o">=</span> <span class="n">format_json</span><span class="p">(</span><span class="n">json1</span><span class="p">);</span>  <span class="c1">// alternative format</span>
</code></pre></div>
<h2 id="ordered-map">Ordered map</h2>
<p>Json dictionaries are stored in an <code>ordered_map</code> structure. Ordered maps are
unsorted just arrays of key-value pairs, with methods added to match the 
map data structures in the standard library, that we do not report here since
it would be a repetition.</p>
<p>We use unsorted arrays for dictionaries since dictionary implementations
tradeoff memory consumption, number of allocation, and insertion and
query speeds. For th specific use of Json values in Yocto/GL, a good trade off
is to reduce memory pressure, while optimizing the lookups only for small 
dictionaries, as is generally the case for the Json values in Yocto/GL.
One exception are large dictionaries that need to be only iterated. 
In that case, we can skip the key checks and insert values at the end directly.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../yocto_sceneio/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Scene serialization
            </div>
          </div>
        </a>
      
      
        <a href="../yocto_modelio/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Model serialization
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2016 - 2020 Fabio Pellacini
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.fb4a9340.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.5cf3e710.min.js"></script>
      
    
  </body>
</html>